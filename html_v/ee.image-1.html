<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>9 ee.Image | Cómo usar Google Earth Engine y no fallar en el intento</title>
  <meta name="description" content="9 ee.Image | Cómo usar Google Earth Engine y no fallar en el intento" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="9 ee.Image | Cómo usar Google Earth Engine y no fallar en el intento" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="9 ee.Image | Cómo usar Google Earth Engine y no fallar en el intento" />
  
  
  

<meta name="author" content="Jonathan Vidal Solórzano Villegas y Gabriel Alejandro Perilla Suárez" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ee.featurecollection-1.html"/>
<link rel="next" href="ee.imagecollection-1.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

true

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cómo usar Google Earth Engine y no fallar en el intento</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ee.image-1" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">9</span> ee.Image<a href="ee.image-1.html#ee.image-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>
Las imágenes (<code>ee.Image</code>) en GEE generalmente se encuentran disponibles en colecciones de imágenes, aunque también existen fuentes de datos particulares que constan de una sola imagen. Las imágenes corresponden a información en formato ráster que cuenta con una resolución espacial, espectral y radiométrica particular (ver Olaya [2020] para una descripción más detallada de un ráster).
Los metadatos de cada imagen en GEE se encuentran como propiedades de esta. A diferencia de las imágenes que posiblemente el usuario esté acostumbrado a manejar, GEE permite que cada banda tenga una resolución de píxel o tipo de datos distinta (Integer, Float, 16 bits, etc.). Esto no afecta el uso de estas imágenes, pero es importante considerarlo si se van a exportar imágenes cuyas bandas tienen distinta resolución espacial (por ejemplo, Sentinel-2), ya que al exportar una imagen multibanda, todas sus bandas deben tener la misma resolución y tipo de datos. Al final de este capítulo se presenta un ejercicio integrador de varios de los procedimientos revisados aquí.</p>
<p>Para ejemplificar esta sección se cargará una imagen global de la altura del dosel para áreas con cobertura arbórea en el 2005 (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f91">9.1</a>).</p>
<p>Ejercicio 27</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb62-1"><a href="ee.image-1.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cargar la imagen global de la altura del dosel para áreas con cobertura </span></span>
<span id="cb62-2"><a href="ee.image-1.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co">// arbórea en el 2005</span></span>
<span id="cb62-3"><a href="ee.image-1.html#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> CHM <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">&#39;NASA/JPL/global_forest_canopy_height_2005&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cargar la imagen global de la altura del dosel para áreas con cobertura 
// arbórea en el 2005
var CHM = ee.Image('NASA/JPL/global_forest_canopy_height_2005');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f91"></span>
<img src="Img/ej271.png" alt="Ejemplo de la  información desplegada en la consola al imprimir una imagen." width="80%" />
<p class="caption">
Figure 9.1: Ejemplo de la información desplegada en la consola al imprimir una imagen.
</p>
</div>
<p>Para realizar los ejercicios de este apartado, se cargarán dos fuentes de información adicionales para aplicar algunos de los métodos disponibles para imágenes. La primera consta de una simple geometría de una región de interés, mientras que la segunda es un vector que contiene el polígono de la superficie de México.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb63-1"><a href="ee.image-1.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cargar un polígono con el área de interés</span></span>
<span id="cb63-2"><a href="ee.image-1.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roi1 <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>(</span>
<span id="cb63-3"><a href="ee.image-1.html#cb63-3" aria-hidden="true" tabindex="-1"></a>        [[[<span class="op">-</span><span class="fl">101.90832388457699</span><span class="op">,</span> <span class="fl">20.455157626721274</span>]<span class="op">,</span></span>
<span id="cb63-4"><a href="ee.image-1.html#cb63-4" aria-hidden="true" tabindex="-1"></a>          [<span class="op">-</span><span class="fl">101.90832388457699</span><span class="op">,</span> <span class="fl">19.422397223570666</span>]<span class="op">,</span></span>
<span id="cb63-5"><a href="ee.image-1.html#cb63-5" aria-hidden="true" tabindex="-1"></a>          [<span class="op">-</span><span class="fl">100.56799185332699</span><span class="op">,</span> <span class="fl">19.422397223570666</span>]<span class="op">,</span></span>
<span id="cb63-6"><a href="ee.image-1.html#cb63-6" aria-hidden="true" tabindex="-1"></a>          [<span class="op">-</span><span class="fl">100.56799185332699</span><span class="op">,</span> <span class="fl">20.455157626721274</span>]]]<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb63-7"><a href="ee.image-1.html#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="ee.image-1.html#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Cargar la colección de atributos de los polígonos de la superficie de </span></span>
<span id="cb63-9"><a href="ee.image-1.html#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="co">// los países</span></span>
<span id="cb63-10"><a href="ee.image-1.html#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MX <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;USDOS/LSIB_SIMPLE/2017&#39;</span>)</span>
<span id="cb63-11"><a href="ee.image-1.html#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Filtrar por la propiedad country_co para elegir México</span></span>
<span id="cb63-12"><a href="ee.image-1.html#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;country_co&#39;</span><span class="op">,</span><span class="st">&#39;MX&#39;</span>))<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cargar un polígono con el área de interés
var roi1 = ee.Geometry.Polygon(
        [[[-101.90832388457699, 20.455157626721274],
          [-101.90832388457699, 19.422397223570666],
          [-100.56799185332699, 19.422397223570666],
          [-100.56799185332699, 20.455157626721274]]], null, false);

// Cargar la colección de atributos de los polígonos de la superficie de 
// los países
var MX = ee.FeatureCollection('USDOS/LSIB_SIMPLE/2017')
  // Filtrar por la propiedad country_co para elegir México
  .filter(ee.Filter.eq('country_co','MX'));
</script>
<p>Adicionalmente, se cargará la primera imagen de una colección de imágenes (Landsat 7). Este procedimiento se verá más a detalle en el siguiente capítulo sobre colecciones de imágenes. Por el momento, cabe aclarar que el método <code>.first</code> permite extraer la primera imagen de una colección de imágenes, tras lo cual el objeto resultante es una imagen (<code>ee.Image</code>). Ya que las imágenes multiespectrales solo se encuentran dentro de colecciones de imágenes, el uso de esta imagen de Landsat 7 nos permitirá ejemplificar algunos de los métodos más utilizados sobre este tipo de objetos.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb64-1"><a href="ee.image-1.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener la primera imagen Landsat 7 de una colección de imágenes.</span></span>
<span id="cb64-2"><a href="ee.image-1.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Cargar colección de imágenes de Landsat 7          </span></span>
<span id="cb64-3"><a href="ee.image-1.html#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> landsat7im <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;LANDSAT/LE07/C01/T1_SR&#39;</span>)</span>
<span id="cb64-4"><a href="ee.image-1.html#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Filtrar por fecha</span></span>
<span id="cb64-5"><a href="ee.image-1.html#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterDate</span>(<span class="st">&#39;2020-01-01&#39;</span><span class="op">,</span><span class="st">&#39;2020-02-01&#39;</span>)</span>
<span id="cb64-6"><a href="ee.image-1.html#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Filtrar imágenes para mantener únicamente las que se sobrepongan con </span></span>
<span id="cb64-7"><a href="ee.image-1.html#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// el área de interés</span></span>
<span id="cb64-8"><a href="ee.image-1.html#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(roi1)</span>
<span id="cb64-9"><a href="ee.image-1.html#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Obtener la primera imagen de la colección</span></span>
<span id="cb64-10"><a href="ee.image-1.html#cb64-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Obtener la primera imagen Landsat 7 de una colección de imágenes.
// Cargar colección de imágenes de Landsat 7          
var landsat7im = ee.ImageCollection('LANDSAT/LE07/C01/T1_SR')
  // Filtrar por fecha
  .filterDate('2020-01-01','2020-02-01')
  // Filtrar imágenes para mantener únicamente las que se sobrepongan con 
  // el área de interés
  .filterBounds(roi1)
  // Obtener la primera imagen de la colección
  .first();
</script>
<div id="información-y-metadatos-3" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Información y metadatos<a href="ee.image-1.html#información-y-metadatos-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>

Para consultar las propiedades de una imagen (metadatos) se puede utilizar el siguiente comando: <code>.propertyNames</code> (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f92">9.2</a>). Otros comandos que facilitan la consulta de algunos elementos particulares son: <code>.bandNames</code>, <code>.projection</code>, <code>.projection().nominalScale</code>, para conocer el nombre de las bandas de la imagen, su proyección y el tamaño de píxel en m que presenta, respectivamente.</p>
<p>Ejercicio 27.1</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb65-1"><a href="ee.image-1.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener las propiedades de la imagen</span></span>
<span id="cb65-2"><a href="ee.image-1.html#cb65-2" aria-hidden="true" tabindex="-1"></a>CHM<span class="op">.</span><span class="fu">propertyNames</span>()<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Obtener las propiedades de la imagen
CHM.propertyNames();
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f92"></span>
<img src="Img/ej272.png" alt="Propiedades de una imagen desplegadas en la consola." width="40%" />
<p class="caption">
Figure 9.2: Propiedades de una imagen desplegadas en la consola.
</p>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>El sistema de coordenadas de referencia de trabajo para todas las capas es EPSG:4326. Si se requiere cambiar de proyección se puede utilizar el método <code>.reproject</code>, aunque no se recomienda hacerlo, a menos que sea estrictamente necesario.</p>
</div>
</div>
<p>
Por otro lado, la información almacenada en un ráster, usualmente está organizada en distintas bandas. Para consultar los nombres de las bandas de una imagen se utiliza el método <code>.bandNames</code> (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f93">9.3</a>).</p>
<p>Ejercicio 27.2</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb66-1"><a href="ee.image-1.html#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener los nombres de las bandas de la imagen</span></span>
<span id="cb66-2"><a href="ee.image-1.html#cb66-2" aria-hidden="true" tabindex="-1"></a>CHM<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Obtener los nombres de las bandas de la imagen
CHM.bandNames();
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f93"></span>
<img src="Img/ej273.png" alt="Nombre de las bandas de la imagen CHM." width="60%" />
<p class="caption">
Figure 9.3: Nombre de las bandas de la imagen CHM.
</p>
</div>
</div>
<div id="visualización-de-una-imagen" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Visualización de una imagen<a href="ee.image-1.html#visualización-de-una-imagen" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>
De igual manera que los vectores y las colecciones de vectores, las imágenes se pueden agregar a la pantalla de mapa mediante la función <code>Map.addLayer</code> (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f94">9.4</a>).</p>
<p>Ejercicio 27.3</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb67-1"><a href="ee.image-1.html#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cargar la imagen a la pantalla de mapa</span></span>
<span id="cb67-2"><a href="ee.image-1.html#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(CHM<span class="op">,</span> </span>
<span id="cb67-3"><a href="ee.image-1.html#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Definir los valores mínimos y máximos de la imagen para su </span></span>
<span id="cb67-4"><a href="ee.image-1.html#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// visualización</span></span>
<span id="cb67-5"><a href="ee.image-1.html#cb67-5" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">32</span>}<span class="op">,</span> </span>
<span id="cb67-6"><a href="ee.image-1.html#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Definir el nombre con el que se desea cargar la imagen a la pantalla </span></span>
<span id="cb67-7"><a href="ee.image-1.html#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// de mapa</span></span>
<span id="cb67-8"><a href="ee.image-1.html#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;primera imagen&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cargar la imagen a la pantalla de mapa
Map.addLayer(CHM, 
  // Definir los valores mínimos y máximos de la imagen para su 
  // visualización
  {min: 0, max: 32}, 
  // Definir el nombre con el que se desea cargar la imagen a la pantalla 
  // de mapa
  'primera imagen');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f94"></span>
<img src="Img/ej274.png" alt="Visualización de la capa de la altura del dosel." width="80%" />
<p class="caption">
Figure 9.4: Visualización de la capa de la altura del dosel.
</p>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>La información ráster en GEE se almacena en un esquema piramidal, es decir, que existen varias copias de la imagen, en la que cada una corresponde a una escala distinta. Al visualizar una imagen en la pantalla de mapa, la imagen mostrada será la de la escala que se encuentre más cercana al nivel del zoom de la pantalla de mapa. Por ello, en algunas ocasiones al usar el Inspector y mover el zoom, el valor de un píxel puede cambiar, ya que se están consultando valores de distintas imágenes (cada una asociada a una escala distinta). Para mayores detalles visitar: <a href="https://developers.google.com/earth-engine/guides/scale" class="uri">https://developers.google.com/earth-engine/guides/scale</a></p>
</div>
</div>
</div>
<div id="métodos-comunes-3" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Métodos comunes<a href="ee.image-1.html#métodos-comunes-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="selección-de-bandas" class="section level3 unnumbered hasAnchor">
<h3>Selección de bandas<a href="ee.image-1.html#selección-de-bandas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Una vez revisados los nombres de las bandas de una imagen, se pueden seleccionar algunas de ellas mediante el método <code>.select</code>. Para seleccionar una única banda solo se requiere indicar el nombre de la banda, mientras que si se desea seleccionar varias bandas, estas deben indicarse dentro de una lista. Por ejemplo (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f95">9.5</a>):</p>
<p>Ejercicio 27.4</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb68-1"><a href="ee.image-1.html#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Seleccionar la banda 1 de la imagen (que es la única)</span></span>
<span id="cb68-2"><a href="ee.image-1.html#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> banda1 <span class="op">=</span> CHM<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;1&#39;</span>)<span class="op">;</span></span>
<span id="cb68-3"><a href="ee.image-1.html#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="ee.image-1.html#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Seleccionar solo las primeras cuatro bandas de la imagen</span></span>
<span id="cb68-5"><a href="ee.image-1.html#cb68-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> landsat7imBands <span class="op">=</span> landsat7im<span class="op">.</span><span class="fu">select</span>([<span class="st">&#39;B1&#39;</span><span class="op">,</span><span class="st">&#39;B2&#39;</span><span class="op">,</span><span class="st">&#39;B3&#39;</span><span class="op">,</span><span class="st">&#39;B4&#39;</span>])<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Seleccionar la banda 1 de la imagen (que es la única)
var banda1 = CHM.select('1');

// Seleccionar solo las primeras cuatro bandas de la imagen
var landsat7imBands = landsat7im.select(['B1','B2','B3','B4']);
</script>
</div>
<div id="adición-de-nuevas-propiedades-o-modificación-de-propiedades-preexistentes-1" class="section level3 unnumbered hasAnchor">
<h3>Adición de nuevas propiedades o modificación de propiedades preexistentes<a href="ee.image-1.html#adición-de-nuevas-propiedades-o-modificación-de-propiedades-preexistentes-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Usando el método <code>.set</code> se pueden modificar las propiedades preexistentes, o escribir nuevas propiedades sobre la imagen. En este caso, primero se indica el nombre de la clave, seguido de su valor correspondiente. Por ejemplo (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f95">9.5</a>):</p>
<p>Ejercicio 27.5</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb69-1"><a href="ee.image-1.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Agregar una nueva propiedad</span></span>
<span id="cb69-2"><a href="ee.image-1.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> CHMprop1 <span class="op">=</span> CHM<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;miPropiedad&#39;</span><span class="op">,</span><span class="st">&#39;miImagen&#39;</span>)<span class="op">;</span></span>
<span id="cb69-3"><a href="ee.image-1.html#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="ee.image-1.html#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Modificar una propiedad preexistente</span></span>
<span id="cb69-5"><a href="ee.image-1.html#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> CHMprop2 <span class="op">=</span> CHM<span class="op">.</span><span class="fu">set</span>(<span class="st">&#39;title&#39;</span><span class="op">,</span><span class="st">&#39;miTítulo&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Agregar una nueva propiedad
var CHMprop1 = CHM.set('miPropiedad','miImagen');

// Modificar una propiedad preexistente
var CHMprop2 = CHM.set('title','miTítulo');
</script>
<p>(ref:sub2) <code>bands</code>
(ref:sub3) <code>properties</code></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f95"></span>
<img src="Img/ej275.png" alt="Salida de la consola tras haber seleccionado algunas bandas o agregar propiedades. Nótense los valores en las entradas de (ref:sub2) y (ref:sub3)." width="60%" />
<p class="caption">
Figure 9.5: Salida de la consola tras haber seleccionado algunas bandas o agregar propiedades. Nótense los valores en las entradas de (ref:sub2) y (ref:sub3).
</p>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>Nótese que se puede sobreescribir la misma variable, pero hay que tener cuidado porque la información anterior se pierde.</p>
</div>
</div>
</div>
<div id="sustitución-de-nombres-de-bandas" class="section level3 unnumbered hasAnchor">
<h3>Sustitución de nombres de bandas<a href="ee.image-1.html#sustitución-de-nombres-de-bandas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Por defecto, el nombre de las bandas de las imágenes suele corresponder a la letra ‘B’ más un número que indica el número de banda. Por ejemplo, ‘B1’, ‘B2’, ‘B3’, etc. En algunos casos, el usuario puede preferir sustituir estos nombres con letras que indiquen la longitud de onda que contiene cada banda. Para ello, se puede utilizar el método <code>.rename</code>. En caso de que la imagen de interés conste de una sola banda y un solo nombre, se puede indicar directamente el nuevo nombre, si no, se debe pasar una lista con el nuevo nombre para cada banda. Por ejemplo (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f95">9.5</a>):</p>
<p>Ejercicio 27.6</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb70-1"><a href="ee.image-1.html#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cambiar el nombre de la banda </span></span>
<span id="cb70-2"><a href="ee.image-1.html#cb70-2" aria-hidden="true" tabindex="-1"></a>banda1 <span class="op">=</span> banda1<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;chm&#39;</span>)<span class="op">;</span></span>
<span id="cb70-3"><a href="ee.image-1.html#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="ee.image-1.html#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> landsat7imBandsRename <span class="op">=</span> landsat7imBands<span class="op">.</span><span class="fu">rename</span>([<span class="st">&#39;B&#39;</span><span class="op">,</span><span class="st">&#39;G&#39;</span><span class="op">,</span><span class="st">&#39;R&#39;</span><span class="op">,</span><span class="st">&#39;NIR&#39;</span>])<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cambiar el nombre de la banda 
banda1 = banda1.rename('chm');

var landsat7imBandsRename = landsat7imBands.rename(['B','G','R','NIR']);
</script>
</div>
<div id="realización-de-cortes" class="section level3 unnumbered hasAnchor">
<h3>Realización de cortes<a href="ee.image-1.html#realización-de-cortes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Para obtener el área de una imagen únicamente de una región de interés se puede utilizar el método <code>.clip</code>. Por ejemplo (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f96">9.6</a>):</p>
<p>Ejercicio 27.7</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb71-1"><a href="ee.image-1.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cortar la imagen a la extensión del polígono de México</span></span>
<span id="cb71-2"><a href="ee.image-1.html#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> chmMx <span class="op">=</span> banda1<span class="op">.</span><span class="fu">clip</span>(MX)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cortar la imagen a la extensión del polígono de México
var chmMx = banda1.clip(MX);
</script>
<p>Esto permite trabajar únicamente con la región de interés (en el ejemplo anterior, especificada en el objeto roi).</p>
<div class="bluebox2">
<div class="awesomeblock">
<p>Se sugiere evitar el uso del método <code>.clip</code> a menos que sea estrictamente necesario, ya que aumenta el tiempo de procesamiento. En muchos casos se puede indicar el área de interés hasta el último paso del procesamiento, que suele implicar la exportación del resultado fuera de GEE (ver última sección de este capítulo: Exportación de una imagen).</p>
</div>
</div>
</div>
<div id="cálculo-de-operaciones-matemáticas" class="section level3 unnumbered hasAnchor">
<h3>Cálculo de operaciones matemáticas<a href="ee.image-1.html#cálculo-de-operaciones-matemáticas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>



Dentro de GEE se puede realizar cualquier operación matemática entre bandas o entre imágenes. Los operadores para realizar esta operaciones son: <code>.subtract</code>, <code>.add</code>, <code>.divide</code>, <code>.multiply</code> para restar, sumar, dividir y multiplicar, respectivamente (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f96">9.6</a>).</p>
<p>Ejercicio 27.8</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb72-1"><a href="ee.image-1.html#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Multiplicar la imagen por 100 para obtener el valor en cm</span></span>
<span id="cb72-2"><a href="ee.image-1.html#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> chmCmMx <span class="op">=</span> chmMx<span class="op">.</span><span class="fu">multiply</span>(<span class="dv">100</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Multiplicar la imagen por 100 para obtener el valor en cm
var chmCmMx = chmMx.multiply(100);
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f96"></span>
<img src="Img/ej276.png" alt="Visualización de la capa de altura del dosel en México." width="80%" />
<p class="caption">
Figure 9.6: Visualización de la capa de altura del dosel en México.
</p>
</div>
<p>Además, GEE cuenta con un método de <code>.normalizedDifference</code> para calcular un índice normalizado a partir de las bandas que se indiquen. Por ejemplo, para calcular el índice de vegetación de diferencia normalizada (NDVI, por sus siglas en inglés), primero se indica la banda del infrarrojo y luego la del rojo. Si se quiere realizar un índice un poco más complicado se puede calcular mediante el método <code>.expression</code>. En este método se indica primero la fórmula del cálculo que se va a realizar (en formato de cadena de texto) y posteriormente se indica en un diccionario la equivalencia de los términos utilizados en la fórmula y los nombres de las bandas de la imagen. Las siguientes dos formas de calcular el NDVI obtienen el mismo resultado:

</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb73-1"><a href="ee.image-1.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Calcular el ndvi con la imagen de landsat 7 obtenida previamente</span></span>
<span id="cb73-2"><a href="ee.image-1.html#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi<span class="op">=</span> landsat7imBands<span class="op">.</span><span class="fu">expression</span>( <span class="st">&#39;(NIR - R) / (NIR + R)&#39;</span><span class="op">,</span> {</span>
<span id="cb73-3"><a href="ee.image-1.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;NIR&#39;</span> <span class="op">=</span> landsat7imBands<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B4&#39;</span>)<span class="op">,</span></span>
<span id="cb73-4"><a href="ee.image-1.html#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;R&#39;</span> <span class="op">=</span> landsat7imBands<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;B3&#39;</span>)</span>
<span id="cb73-5"><a href="ee.image-1.html#cb73-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb73-6"><a href="ee.image-1.html#cb73-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Renombrar la banda como &#39;ndvi&#39;</span></span>
<span id="cb73-7"><a href="ee.image-1.html#cb73-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span>
<span id="cb73-8"><a href="ee.image-1.html#cb73-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb73-9"><a href="ee.image-1.html#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndvi2 <span class="op">=</span> landsat7imBands<span class="op">.</span><span class="fu">normalizedDifference</span>(<span class="st">&#39;B4&#39;</span><span class="op">,</span><span class="st">&#39;B3&#39;</span>)</span>
<span id="cb73-10"><a href="ee.image-1.html#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Renombrar la banda como &#39;ndvi&#39;</span></span>
<span id="cb73-11"><a href="ee.image-1.html#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Calcular el ndvi con la imagen de landsat 7 obtenida previamente
var ndvi= landsat7imBands.expression( '(NIR - R) / (NIR + R)', {
  'NIR' = landsat7imBands.select('B4'),
  'R' = landsat7imBands.select('B3')
})
  // Renombrar la banda como 'ndvi'
  .rename('ndvi');
  
var ndvi2 = landsat7imBands.normalizedDifference('B4','B3')
  // Renombrar la banda como 'ndvi'
  .rename('ndvi');
</script>
<div class="bluebox2">
<div class="awesomeblock">
<p>Si no se cambia el nombre de la banda producida por <code>.normalizedDifference</code>, por defecto, esta va a recibir el nombre de ‘nd’.</p>
</div>
</div>
<p>Para las fórmulas utilizadas dentro de <code>expression</code> se puede utilizar la notación estándar matemática (<code>+</code>, <code>-</code>, <code>/</code>, <code>*</code>), módulo (<code>%</code>), exponente (<code>**</code>), relacionales (<code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>!=</code>, <code>==</code>), lógicos (<code>&amp;&amp;</code>, <code>||</code>, <code>!</code>, <code>^</code>) o if then else (<code>?:</code>).</p>
</div>
<div id="uso-de-operaciones-relacionales-condicionales-y-booleanas" class="section level3 unnumbered hasAnchor">
<h3>Uso de operaciones relacionales, condicionales y booleanas<a href="ee.image-1.html#uso-de-operaciones-relacionales-condicionales-y-booleanas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>





Se pueden utilizar operadores relacionales, condicionales o booleanos sobre las imágenes para crear clases o máscaras. Para ello, se utilizan las siguientes notaciones: <code>.lt</code>, <code>.lte</code>, <code>.gt</code>, <code>.gte</code>, <code>.eq</code>, <code>.neq</code>, que equivalen a menor que (<em>less than</em>), menor que o igual (<em>less than or equal</em>), mayor que (<em>greater than</em>), mayor que o igual (<em>greater than or equal</em>), igual (<em>equal</em>) o no igual (<em>not equal</em>), respectivamente. Además, se pueden utilizar operadores relacionales para unir dos condiciones mediante <code>.and</code> u <code>.or</code>, es decir, y u o. Por ejemplo, la siguiente línea permite crear una máscara de las áreas que tengan valores menores o iguales a 0.2 y mayores o iguales a 0 (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f97">9.7</a>):</p>
<p>Ejercicio 27.9</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb74-1"><a href="ee.image-1.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Crear una imagen de los píxeles que cumplen con la condición de tener </span></span>
<span id="cb74-2"><a href="ee.image-1.html#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co">// valores mayores o iguales a 20</span></span>
<span id="cb74-3"><a href="ee.image-1.html#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Nótese que se utiliza la imagen con valores en m</span></span>
<span id="cb74-4"><a href="ee.image-1.html#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> chmMXMask20 <span class="op">=</span> chmMx<span class="op">.</span><span class="fu">gte</span>(<span class="dv">20</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Crear una imagen de los píxeles que cumplen con la condición de tener 
// valores mayores o iguales a 20
// Nótese que se utiliza la imagen con valores en m
var chmMXMask20 = chmMx.gte(20);
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f97"></span>
<img src="Img/ej277.png" alt="Resultado de la máscara booleana de altura del dosel." width="80%" />
<p class="caption">
Figure 9.7: Resultado de la máscara booleana de altura del dosel.
</p>
</div>
<p>Otra forma de crear máscaras es indicando valores por bits. En este caso, se indica el valor del bit de interés y después se evalúa una condición sobre una banda determinada. Por ejemplo, para Landsat 8, la banda de evaluación de la calidad de la imagen corresponde a la banda ‘pixel_qa’. En esta banda, el bit 5 indica una cobertura de nubes, así que primero se define una variable que indique que el bit 5 es el que será evaluado. Después se selecciona la banda ‘pixel_qa’ para evaluar qué píxeles tienen un valor de 0 en el bit 5 (valores a conservar) y cuáles no (valores a eliminar; <span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f98">9.11</a>).

Ejercicio 27.10</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb75-1"><a href="ee.image-1.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Definir la regla en bits de la imagen de los valores que se desea </span></span>
<span id="cb75-2"><a href="ee.image-1.html#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="co">// enmascarar</span></span>
<span id="cb75-3"><a href="ee.image-1.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> nubesBit <span class="op">=</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb75-4"><a href="ee.image-1.html#cb75-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-5"><a href="ee.image-1.html#cb75-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Seleccionar la banda de evaluación de la calidad de la imagen</span></span>
<span id="cb75-6"><a href="ee.image-1.html#cb75-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> qa <span class="op">=</span> landsat7im<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pixel_qa&#39;</span>)<span class="op">;</span></span>
<span id="cb75-7"><a href="ee.image-1.html#cb75-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-8"><a href="ee.image-1.html#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Definir una máscara donde las áreas a mantener (1) serán las áreas </span></span>
<span id="cb75-9"><a href="ee.image-1.html#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="co">// donde el bit 5 tenga valores iguales a cero</span></span>
<span id="cb75-10"><a href="ee.image-1.html#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(nubesBit)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Definir la regla en bits de la imagen de los valores que se desea 
// enmascarar
var nubesBit = (1 << 5);

// Seleccionar la banda de evaluación de la calidad de la imagen
var qa = landsat7im.select('pixel_qa');

// Definir una máscara donde las áreas a mantener (1) serán las áreas 
// donde el bit 5 tenga valores iguales a cero
var mask = qa.bitwiseAnd(nubesBit).eq(0);
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-76"></span>
<img src="Img/ej278.png" alt="Visualización de la máscara de Landsat 8 indicando píxeles con nubes y sin nubes." width="80%" />
<p class="caption">
Figure 9.8: Visualización de la máscara de Landsat 8 indicando píxeles con nubes y sin nubes.
</p>
</div>
</div>
<div id="enmascaramiento" class="section level3 unnumbered hasAnchor">
<h3>Enmascaramiento<a href="ee.image-1.html#enmascaramiento" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
El método <code>.updateMask</code> permite enmascarar los píxeles de una imagen, utilizando otra imagen como máscara que indique cuáles píxeles se deben conservar (valores de 1) y cuáles enmascarar (valores de 0). En la figura 9.9 se puede apreciar la visualización del enmascaramiento realizado a la capa que contiene la altura del dosel. Por su parte, las figuras 9.10 y 9.11 muestran la imagen Landsat 8 antes y después de realizar el enmascaramiento de nubes, respectivamente.</p>
<p>Ejercicio 27.11</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb76-1"><a href="ee.image-1.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Utilizar la máscara de valores que tienen alturas &gt;= 20 y aplicarla a </span></span>
<span id="cb76-2"><a href="ee.image-1.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">// la imagen con los valores de alturas</span></span>
<span id="cb76-3"><a href="ee.image-1.html#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> chmMxMayor20 <span class="op">=</span> chmMx<span class="op">.</span><span class="fu">updateMask</span>(chmMXMask20)<span class="op">;</span></span>
<span id="cb76-4"><a href="ee.image-1.html#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="ee.image-1.html#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Aplicar la máscara a la imagen original</span></span>
<span id="cb76-6"><a href="ee.image-1.html#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> landsat7imMask <span class="op">=</span> landsat7im<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Utilizar la máscara de valores que tienen alturas >= 20 y aplicarla a 
// la imagen con los valores de alturas
var chmMxMayor20 = chmMx.updateMask(chmMXMask20);

// Aplicar la máscara a la imagen original
var landsat7imMask = landsat7im.updateMask(mask);
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-78"></span>
<img src="Img/ej279.png" alt="Resultado del enmascaramiento de la capa de altura del dosel." width="80%" />
<p class="caption">
Figure 9.9: Resultado del enmascaramiento de la capa de altura del dosel.
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-79"></span>
<img src="Img/ej270.png" alt="Imagen Landsat antes del enmascaramiento de nubes." width="80%" />
<p class="caption">
Figure 9.10: Imagen Landsat antes del enmascaramiento de nubes.
</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f98"></span>
<img src="Img/ej27a.png" alt="Imagen Landsat después del enmascaramiento de nubes. Nótese que las áreas enmascaradas ahora son transparentes." width="80%" />
<p class="caption">
Figure 9.11: Imagen Landsat después del enmascaramiento de nubes. Nótese que las áreas enmascaradas ahora son transparentes.
</p>
</div>
<p></p>
<div class="bluebox2">
<div class="awesomeblock">
<p>Aunque en GEE existe el método <code>.mask</code> para enmascarar áreas de una imagen, se sugiere siempre utilizar <code>.updateMask</code>. El método <code>.mask</code> simplemente sustituye la máscara original de la imagen, mientras que <code>.updateMask</code> combina la máscara anterior con la nueva, lo que evita desenmascarar áreas que seguramente no son de interés para el usuario.</p>
</div>
</div>
</div>
<div id="adición-de-bandas" class="section level3 unnumbered hasAnchor">
<h3>Adición de bandas<a href="ee.image-1.html#adición-de-bandas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
El usuario puede agregar una banda al conjunto de bandas que contiene por defecto una imagen utilizando el método <code>.addBands</code>. Así, se podría agregar una banda que contenga algún índice calculado con las bandas originales de la imagen. Por ejemplo:</p>
<p>Ejercicio 27.12</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb77-1"><a href="ee.image-1.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Agregar la banda de alturas en cm a la banda original en m</span></span>
<span id="cb77-2"><a href="ee.image-1.html#cb77-2" aria-hidden="true" tabindex="-1"></a>chmMx2Bands <span class="op">=</span> chmMx<span class="op">.</span><span class="fu">addBands</span>(chmCmMx<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;chmCm&#39;</span>))<span class="op">;</span></span>
<span id="cb77-3"><a href="ee.image-1.html#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="ee.image-1.html#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Agregar la banda de ndvi a la imagen original</span></span>
<span id="cb77-5"><a href="ee.image-1.html#cb77-5" aria-hidden="true" tabindex="-1"></a>landsat7im <span class="op">=</span> landsat7im<span class="op">.</span><span class="fu">addBands</span>(ndvi)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Agregar la banda de alturas en cm a la banda original en m
chmMx2Bands = chmMx.addBands(chmCmMx.rename('chmCm'));

// Agregar la banda de ndvi a la imagen original
landsat7im = landsat7im.addBands(ndvi);
</script>
</div>
<div id="conversión-de-una-imagen-en-un-vector" class="section level3 unnumbered hasAnchor">
<h3>Conversión de una imagen en un vector<a href="ee.image-1.html#conversión-de-una-imagen-en-un-vector" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
En algunos casos puede ser conveniente transformar una imagen en un vector, o parte de una imagen en un vector. El método para convertir una imagen en vector es <code>.reduceToVectors</code> y se utiliza de la siguiente manera (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f99">9.12</a>):</p>
<p>Ejercicio 27.13</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb78-1"><a href="ee.image-1.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Convertir la máscara de valores que tienen valores de altura &gt;= 20 a </span></span>
<span id="cb78-2"><a href="ee.image-1.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co">// vector</span></span>
<span id="cb78-3"><a href="ee.image-1.html#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> chmMxMayor20Vec <span class="op">=</span> chmMXMask20<span class="op">.</span><span class="fu">reduceToVectors</span>({</span>
<span id="cb78-4"><a href="ee.image-1.html#cb78-4" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Usar el polígono de México para definir el área a convertir a </span></span>
<span id="cb78-5"><a href="ee.image-1.html#cb78-5" aria-hidden="true" tabindex="-1"></a>     <span class="co">// vector</span></span>
<span id="cb78-6"><a href="ee.image-1.html#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">geometry</span><span class="op">:</span> MX<span class="op">,</span></span>
<span id="cb78-7"><a href="ee.image-1.html#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Definir el tipo de geometría que se desea</span></span>
<span id="cb78-8"><a href="ee.image-1.html#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">geometryType</span><span class="op">:</span> <span class="st">&#39;polygon&#39;</span><span class="op">,</span></span>
<span id="cb78-9"><a href="ee.image-1.html#cb78-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Definir el tamaño de píxel en m con el cual se va a crear el vector</span></span>
<span id="cb78-10"><a href="ee.image-1.html#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">1200</span><span class="op">,</span></span>
<span id="cb78-11"><a href="ee.image-1.html#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Definir el tamaño máximo de píxeles a procesar</span></span>
<span id="cb78-12"><a href="ee.image-1.html#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e11</span></span>
<span id="cb78-13"><a href="ee.image-1.html#cb78-13" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Convertir la máscara de valores que tienen valores de altura >= 20 a 
// vector
var chmMxMayor20Vec = chmMXMask20.reduceToVectors({
     // Usar el polígono de México para definir el área a convertir a 
     // vector
  geometry: MX,
// Definir el tipo de geometría que se desea
  geometryType: 'polygon',
// Definir el tamaño de píxel en m con el cual se va a crear el vector
  scale: 1200,
// Definir el tamaño máximo de píxeles a procesar
  maxPixels: 1e11
});
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f99"></span>
<img src="Img/mexicoVector.png" alt="Visualización de la capa vector producida a partir de una imagen." width="80%" />
<p class="caption">
Figure 9.12: Visualización de la capa vector producida a partir de una imagen.
</p>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>En operaciones como la conversión de ráster a vector, donde se debe indicar el tamaño del píxel para realizar el proceso, el argumento de scale le indica a GEE la escala de la representación piramidal de una imagen de la cual va a tomar los valores para realizar la operación. Ver sección 9.3.</p>
</div>
</div>
</div>
<div id="exportación-de-una-imagen" class="section level3 unnumbered hasAnchor">
<h3>Exportación de una imagen<a href="ee.image-1.html#exportación-de-una-imagen" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
En GEE se pueden exportar imágenes a los <strong>Assets</strong>, al <strong>Google Drive</strong> o al <strong>GoogleCloud</strong>. Debido a que el servicio más común será el de <strong>Drive</strong> este es el se explicará. La función para realizar dicha exportación es <code>Export.imageToDrive</code> (ver Sección 3.4). Los argumentos de esta función son: <code>image</code> (la imagen a exportar), <code>description</code> (el nombre con el que se desea guardar el archivo), <code>folder</code> (la carpeta donde se desea guardar la imagen), <code>scale</code> (la escala para exportar la imagen), <code>maxPixels</code> (el número máximo de píxeles permitido), <code>format</code> (el formato de imagen deseado), <code>region</code> (región que se desea exportar, suele corresponder al área de interés) y <code>crs</code> (sistema de coordenadas de referencia). La función es capaz de aceptar otros argumentos que se pueden consultar en la sección de <strong>Reference</strong> o en la pestaña de <strong>Docs</strong>, así como los valores por defecto de cada uno de estos parámetros. Cabe mencionar que todos los argumentos son opcionales, excepto la imagen a exportar, sin embargo, se recomienda siempre definir por lo menos los argumentos de descripción, carpeta, escala y región. En el caso de la exportación a <strong>Assets</strong> el argumento más importante es <code>assetId</code>, que corresponde al nombre con el que se guardará el archivo en la sección de <strong>Assets</strong>.</p>
<p>Ejercicio 27.14</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb79-1"><a href="ee.image-1.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Exportación al drive personal</span></span>
<span id="cb79-2"><a href="ee.image-1.html#cb79-2" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb79-3"><a href="ee.image-1.html#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Nombre de la imagen a exportar en GEE</span></span>
<span id="cb79-4"><a href="ee.image-1.html#cb79-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">image</span><span class="op">:</span>chmMx<span class="op">,</span> </span>
<span id="cb79-5"><a href="ee.image-1.html#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Nombre con el que se va a guardar la imagen en el drive</span></span>
<span id="cb79-6"><a href="ee.image-1.html#cb79-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span><span class="st">&#39;CanopyHeightModelMX&#39;</span><span class="op">,</span></span>
<span id="cb79-7"><a href="ee.image-1.html#cb79-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Carpeta dentro del drive en el cual se va a exportar la imagen</span></span>
<span id="cb79-8"><a href="ee.image-1.html#cb79-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">folder</span><span class="op">:</span><span class="st">&#39;carpeta_clase_GEE&#39;</span><span class="op">,</span></span>
<span id="cb79-9"><a href="ee.image-1.html#cb79-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tamaño en m del píxel de la imagen a exportar</span></span>
<span id="cb79-10"><a href="ee.image-1.html#cb79-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb79-11"><a href="ee.image-1.html#cb79-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Tamaño en m del píxel de la imagen a exportar</span></span>
<span id="cb79-12"><a href="ee.image-1.html#cb79-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span><span class="fl">1e12</span><span class="op">,</span></span>
<span id="cb79-13"><a href="ee.image-1.html#cb79-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Formato en el cual se va a exportar la imagen</span></span>
<span id="cb79-14"><a href="ee.image-1.html#cb79-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fileFormat</span><span class="op">:</span> <span class="st">&#39;GeoTIFF&#39;</span><span class="op">,</span></span>
<span id="cb79-15"><a href="ee.image-1.html#cb79-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Región de la imagen a exportar</span></span>
<span id="cb79-16"><a href="ee.image-1.html#cb79-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">region</span><span class="op">:</span> roi1<span class="op">,</span></span>
<span id="cb79-17"><a href="ee.image-1.html#cb79-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Definir sistema de coordenadas de referencia</span></span>
<span id="cb79-18"><a href="ee.image-1.html#cb79-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">crs</span><span class="op">:</span> <span class="st">&#39;EPSG:4326&#39;</span></span>
<span id="cb79-19"><a href="ee.image-1.html#cb79-19" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Exportación al drive personal
Export.image.toDrive({
  // Nombre de la imagen a exportar en GEE
  image:chmMx, 
  // Nombre con el que se va a guardar la imagen en el drive
  description:'CanopyHeightModelMX',
  // Carpeta dentro del drive en el cual se va a exportar la imagen
  folder:'carpeta_clase_GEE',
  // Tamaño en m del píxel de la imagen a exportar
  scale: 30,
  // Tamaño en m del píxel de la imagen a exportar
  maxPixels:1e12,
  // Formato en el cual se va a exportar la imagen
  fileFormat: 'GeoTIFF',
  // Región de la imagen a exportar
  region: roi1,
  // Definir sistema de coordenadas de referencia
  crs: 'EPSG:4326'
});
</script>
<div class="bluebox2">
<div class="awesomeblock">
<p>En la experiencia de los autores, el valor máximo de píxeles que permite exportar GEE es 1e13, es decir, un uno seguido de trece ceros.</p>
</div>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>El sistema de coordenadas de referencia (CRS, por sus siglas en inglés) usado en el ejemplo anterior se definió de acuerdo a un código EPSG. Estos pueden consultarse en el siguiente enlace: <a href="https://epsg.io/" class="uri">https://epsg.io/</a>. Por defecto, el sistema de coordenadas de referencia de la información almacenada en GEE corresponde a coordenadas geográficas WGS84 (EPSG:4326) con un tamaño de píxel de un grado. Recuerde que para mostrar la información en la pantalla de mapa, esta se proyecta a un CRS con la clave EPSG:3857, sin embargo, dicha proyección únicamente se hace para desplegar la información, mas no transforma la información con la que el usuario está trabajando. Por lo tanto, puede haber pequeñas diferencias entre la información visualizada en la pantalla de mapa y la información exportada.</p>
</div>
</div>
<p>Es importante recordar que es necesario dar clic a las tareas en la pestaña <strong>Tasks</strong> para que se lleve a cabo la exportación.</p>
<div id="ejercicio-a-consulta-y-procesamiento-de-una-imagen" class="section level4 unnumbered hasAnchor">
<h4>Ejercicio A: Consulta y procesamiento de una imagen<a href="ee.image-1.html#ejercicio-a-consulta-y-procesamiento-de-una-imagen" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>En GEE hay algunos objetos que constan de imágenes únicas, por lo tanto, se pueden utilizar directamente sobre ellas los métodos para el procesamiento de imágenes. Un ejemplo muy utilizado de este tipo de objetos es el modelo digital de elevación (DEM) producido por la misión SRTM (Shuttle Radar Topography Mission). Para buscar cuál es la localización para acceder a esta información se puede ir a la barra de búsqueda (<strong>Search</strong>) y escribir SRTM. Debería aparecer una ventana así (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f910">9.13</a>):</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f910"></span>
<img src="Img/SRTM.png" alt="Ejemplo de búsqueda de información en la barra de búsqueda." width="80%" />
<p class="caption">
Figure 9.13: Ejemplo de búsqueda de información en la barra de búsqueda.
</p>
</div>
<p>Posteriormente se da clic sobre el primer resultado y debería abrirse la siguiente ventana (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f911">9.14</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f911"></span>
<img src="Img/SRTM_prop.png" alt="Consulta de información de una imagen del repositorio de GEE." width="80%" />
<p class="caption">
Figure 9.14: Consulta de información de una imagen del repositorio de GEE.
</p>
</div>
<p>Aquí, se puede copiar la ubicación de la imagen del DEM de SRTM en los servidores de Google. Posteriormente, en la pantalla de rutinas se puede escribir la siguiente línea para guardar la imagen SRTM en un objeto nuevo llamado <code>dem</code>.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb80-1"><a href="ee.image-1.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cargar la imagen con el DEM de SRTM</span></span>
<span id="cb80-2"><a href="ee.image-1.html#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> dem <span class="op">=</span> ee<span class="op">.</span><span class="fu">Image</span>(<span class="st">&#39;CGIAR/SRTM90_V4&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cargar la imagen con el DEM de SRTM
var dem = ee.Image('CGIAR/SRTM90_V4');
</script>
<p>Posteriormente, se corta el DEM a la extensión que nos interesa. En este caso se utilizará la colección con los límites políticos del mundo que se encuentra cargada en GEE. Esta se puede buscar de igual manera que la capa de SRTM, en la barra de búsqueda. Posteriormente, se puede consultar la información que contiene la capa en la pestaña de <strong>TABLE SCHEMA</strong>. Por último, se aplica un filtro para seleccionar el país que nos interesa, en este caso México.

</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb81-1"><a href="ee.image-1.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cargar la colección de atributos con polígonos de la superficie de los </span></span>
<span id="cb81-2"><a href="ee.image-1.html#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="co">// países</span></span>
<span id="cb81-3"><a href="ee.image-1.html#cb81-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> MX <span class="op">=</span> ee<span class="op">.</span><span class="fu">FeatureCollection</span>(<span class="st">&#39;USDOS/LSIB_SIMPLE/2017&#39;</span>)</span>
<span id="cb81-4"><a href="ee.image-1.html#cb81-4" aria-hidden="true" tabindex="-1"></a>   <span class="co">// Filtrar para seleccionar únicamente México</span></span>
<span id="cb81-5"><a href="ee.image-1.html#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;country_co&#39;</span><span class="op">,</span><span class="st">&#39;MX&#39;</span>))<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cargar la colección de atributos con polígonos de la superficie de los 
// países
var MX = ee.FeatureCollection('USDOS/LSIB_SIMPLE/2017')
   // Filtrar para seleccionar únicamente México
  .filter(ee.Filter.eq('country_co','MX'));
</script>
<p>Y se corta la imagen a la extensión del polígono de interés.
</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb82-1"><a href="ee.image-1.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cortar el DEM con el polígono de México</span></span>
<span id="cb82-2"><a href="ee.image-1.html#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> demCortado <span class="op">=</span> dem<span class="op">.</span><span class="fu">clip</span>(MX)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cortar el DEM con el polígono de México
var demCortado = dem.clip(MX);
</script>
<p>Para comparar el DEM antes y después de cortar la imagen a la extensión del polígono de interés, se cargan los dos objetos: <code>dem</code> y <code>demCortado</code>.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb83-1"><a href="ee.image-1.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cargar el DEM global y el cortado (solo MX), indicando valores máximos </span></span>
<span id="cb83-2"><a href="ee.image-1.html#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="co">// y mínimos en m</span></span>
<span id="cb83-3"><a href="ee.image-1.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(dem<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">4000</span>}<span class="op">,</span> <span class="st">&#39;dem&#39;</span>)<span class="op">;</span></span>
<span id="cb83-4"><a href="ee.image-1.html#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(demCortado<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="dv">4000</span>}<span class="op">,</span> <span class="st">&#39;demMX&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cargar el DEM global y el cortado (solo MX), indicando valores máximos 
// y mínimos en m
Map.addLayer(dem, {min: 0, max:4000}, 'dem');
Map.addLayer(demCortado, {min: 0, max:4000}, 'demMX');
</script>
<p>Posteriormente, se define una máscara de todas las áreas que tengan una elevación menor o igual a 2500 m s.n.m. y mayor o igual a 1000 m s.n.m. Después, se aplica esta máscara al DEM cortado para mantener únicamente las áreas que cumplan con el criterio anterior.



</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb84-1"><a href="ee.image-1.html#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Crear máscara de zona de interés</span></span>
<span id="cb84-2"><a href="ee.image-1.html#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> mascara <span class="op">=</span> demCortado<span class="op">.</span><span class="fu">lte</span>(<span class="dv">2500</span>)<span class="op">.</span><span class="fu">and</span>(demCortado<span class="op">.</span><span class="fu">gte</span>(<span class="dv">1000</span>))<span class="op">;</span></span>
<span id="cb84-3"><a href="ee.image-1.html#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Aplicar máscara al DEM de México</span></span>
<span id="cb84-4"><a href="ee.image-1.html#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imgEnmascarada <span class="op">=</span> demCortado<span class="op">.</span><span class="fu">updateMask</span>(mascara)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Crear máscara de zona de interés
var mascara = demCortado.lte(2500).and(demCortado.gte(1000));
// Aplicar máscara al DEM de México
var imgEnmascarada = demCortado.updateMask(mascara);
</script>
<p>A continuación, se renombrará la banda de la imagen de ‘elevation’ a ‘elevacion’ y se agrega la imagen a la pantalla de mapa.
</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb85-1"><a href="ee.image-1.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cambiar el nombre de la banda de la imagen enmascarada a elevacion</span></span>
<span id="cb85-2"><a href="ee.image-1.html#cb85-2" aria-hidden="true" tabindex="-1"></a>imgEnmascarada <span class="op">=</span> imgEnmascarada<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;elevacion&#39;</span>)<span class="op">;</span></span>
<span id="cb85-3"><a href="ee.image-1.html#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Agregar imagen enmascarada a la pantalla de mapa</span></span>
<span id="cb85-4"><a href="ee.image-1.html#cb85-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(imgEnmascarada<span class="op">,</span>{<span class="dt">min</span><span class="op">:</span> <span class="dv">1000</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2500</span>}<span class="op">,</span> <span class="st">&#39;imgEnmascarada&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cambiar el nombre de la banda de la imagen enmascarada a elevacion
imgEnmascarada = imgEnmascarada.rename('elevacion');
// Agregar imagen enmascarada a la pantalla de mapa
Map.addLayer(imgEnmascarada,{min: 1000, max: 2500}, 'imgEnmascarada');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-89"></span>
<img src="Img/ejercicioAMaps.png" alt="Visualización de las tres capas generadas: DEM sin corte, DEM con corte, DEM con corte y enmascarada." width="80%" />
<p class="caption">
Figure 9.15: Visualización de las tres capas generadas: DEM sin corte, DEM con corte, DEM con corte y enmascarada.
</p>
</div>
<p>A continuación, se generará un gráfico para obtener un histograma de los valores de elevación del DEM. Para hacer esto, se utiliza la función <code>ui.Chart.image.histogram</code> y se indica la imagen de la cual se quiere obtener el histograma (<code>image</code>), la escala en metros a la que se quiere obtener los valores del histograma (<code>scale</code>) y el número máximo de clases (<code>maxBuckets</code>). Después, se agrega este gráfico a la consola con un <code>print</code> (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f914">9.16</a>).
</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb86-1"><a href="ee.image-1.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Crear gráfico de histograma de los valores del DEM enmascarado</span></span>
<span id="cb86-2"><a href="ee.image-1.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> graficoHistograma <span class="op">=</span> ui<span class="op">.</span><span class="at">Chart</span><span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">histogram</span>({</span>
<span id="cb86-3"><a href="ee.image-1.html#cb86-3" aria-hidden="true" tabindex="-1"></a>     <span class="co">// Indicar imagen de la cual se va a crear el histograma  </span></span>
<span id="cb86-4"><a href="ee.image-1.html#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">image</span><span class="op">:</span> imgEnmascarada<span class="op">,</span></span>
<span id="cb86-5"><a href="ee.image-1.html#cb86-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Indicar la escala en m a la que se va a muestrear la información para  </span></span>
<span id="cb86-6"><a href="ee.image-1.html#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// obtener el histograma</span></span>
<span id="cb86-7"><a href="ee.image-1.html#cb86-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">9000</span><span class="op">,</span></span>
<span id="cb86-8"><a href="ee.image-1.html#cb86-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Indicar el número máximo de categorías (en eje x) para crear el </span></span>
<span id="cb86-9"><a href="ee.image-1.html#cb86-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// histograma</span></span>
<span id="cb86-10"><a href="ee.image-1.html#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">maxBuckets</span><span class="op">:</span> <span class="dv">10</span></span>
<span id="cb86-11"><a href="ee.image-1.html#cb86-11" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb86-12"><a href="ee.image-1.html#cb86-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-13"><a href="ee.image-1.html#cb86-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(graficoHistograma<span class="op">,</span><span class="st">&#39;gráfico Histograma&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Crear gráfico de histograma de los valores del DEM enmascarado
var graficoHistograma = ui.Chart.image.histogram({
     // Indicar imagen de la cual se va a crear el histograma  
  image: imgEnmascarada,
  // Indicar la escala en m a la que se va a muestrear la información para  
  // obtener el histograma
  scale: 9000,
  // Indicar el número máximo de categorías (en eje x) para crear el 
  // histograma
  maxBuckets: 10
  });

print(graficoHistograma,'gráfico Histograma');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f914"></span>
<img src="Img/histElevacion.png" alt="Histograma de valores del DEM." width="80%" />
<p class="caption">
Figure 9.16: Histograma de valores del DEM.
</p>
</div>
<p>Por último, se puede exportar el resultado al <strong>Google Drive</strong> del usuario. En este caso se definirá un valor de <code>scale</code> de 9000 para acelerar el tiempo que requiere la exportación.
</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb87-1"><a href="ee.image-1.html#cb87-1" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb87-2"><a href="ee.image-1.html#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">image</span><span class="op">:</span>imgEnmascarada<span class="op">,</span> </span>
<span id="cb87-3"><a href="ee.image-1.html#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span><span class="st">&#39;MX_DEM1000-2500msnm&#39;</span><span class="op">,</span></span>
<span id="cb87-4"><a href="ee.image-1.html#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">folder</span><span class="op">:</span><span class="st">&#39;carpeta_clase_GEE&#39;</span><span class="op">,</span></span>
<span id="cb87-5"><a href="ee.image-1.html#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">9000</span><span class="op">,</span></span>
<span id="cb87-6"><a href="ee.image-1.html#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span><span class="fl">1e12</span><span class="op">,</span></span>
<span id="cb87-7"><a href="ee.image-1.html#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fileFormat</span><span class="op">:</span> <span class="st">&#39;GeoTIFF&#39;</span><span class="op">,</span></span>
<span id="cb87-8"><a href="ee.image-1.html#cb87-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">region</span><span class="op">:</span> MX<span class="op">,</span></span>
<span id="cb87-9"><a href="ee.image-1.html#cb87-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">crs</span><span class="op">:</span> <span class="st">&#39;EPSG:4326&#39;</span></span>
<span id="cb87-10"><a href="ee.image-1.html#cb87-10" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
Export.image.toDrive({
  image:imgEnmascarada, 
  description:'MX_DEM1000-2500msnm',
  folder:'carpeta_clase_GEE',
  scale: 9000,
  maxPixels:1e12,
  fileFormat: 'GeoTIFF',
  region: MX,
  crs: 'EPSG:4326'
});
</script>
<p>Una vez corrido el código, hay que irse a la pestaña de <strong>Tasks</strong> para darle clic en <strong>Run</strong> (correr) y comenzar a exportar la imagen al <strong>Google Drive</strong> (<span style="color: darkblue;">Fig.</span> <a href="ee.image-1.html#fig:f915">9.17</a>). A continuación aparece una pantalla, en la cual podemos confirmar los parámetros utilizados para la exportación de la imagen, tras lo cual, se vuelve a dar clic en <strong>Run</strong>. Por último, el producto exportado aparecerá en la pestaña de <strong>Tasks</strong> con un símbolo de un engranaje girando, el cual indica que el proceso está corriendo. Además, en esta pestaña se puede consultar el tiempo de demora del trabajo de exportación. Ya que la imagen haya sido exportada al <strong>Drive</strong>, la tarea cambiará a color azul y el engranaje en movimiento cambiará a una palomita indicando el tiempo demorado en exportar la imagen al <strong>Drive</strong> (ver Fig. 2.22).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f915"></span>
<img src="Img/exportCHMMX.png" alt="Vista de la pestaña de Tasks (tareas) para correr el trabajo de exportación." width="80%" />
<p class="caption">
Figure 9.17: Vista de la pestaña de <strong>Tasks</strong> (tareas) para correr el trabajo de exportación.
</p>
</div>

<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ee.featurecollection-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ee.imagecollection-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["ManualGEE.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
