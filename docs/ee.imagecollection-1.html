<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>10 ee.ImageCollection | Cómo usar Google Earth Engine y no fallar en el intento</title>
  <meta name="description" content="10 ee.ImageCollection | Cómo usar Google Earth Engine y no fallar en el intento" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="10 ee.ImageCollection | Cómo usar Google Earth Engine y no fallar en el intento" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="10 ee.ImageCollection | Cómo usar Google Earth Engine y no fallar en el intento" />
  
  
  

<meta name="author" content="Jonathan Vidal Solórzano Villegas y Gabriel Alejandro Perilla Suárez" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ee.image-1.html"/>
<link rel="next" href="uso-conjunto-de-vectores-e-imágenes.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

true

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cómo usar Google Earth Engine y no fallar en el intento</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ee.imagecollection-1" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">10</span> ee.ImageCollection<a href="ee.imagecollection-1.html#ee.imagecollection-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>
Las colecciones de imágenes (<code>ee.ImageCollection</code>) son objetos de GEE que contienen un conjunto de imágenes. La mayoría de los acervos de imágenes disponibles en GEE van a ser definidos como este tipo de objetos. Para el manejo de varias imágenes se recomienda utilizar esta estructura, en lugar de listas u otro tipo de objetos. La mayoría de las colecciones de imágenes disponibles en GEE incluyen acervos de imágenes gratuitas como Landsat 1-5 y 7-9, MODIS, Sentinel 1-3 y 5, ASTER, entre otras (Gorelick et al., 2017; Radočaj et al., 2020). Al final de este capítulo se presentan ejercicios integradores de varios de los procedimientos revisados en este capítulo.</p>
<p>Por ejemplo, para cargar la colección de reflectancia de la superficie de imágenes Sentinel-2 se usaría el siguiente código:</p>
<p>Ejercicio 28</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb88-1"><a href="ee.imagecollection-1.html#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cargar la colección de Sentinel-2 reflectancia de la superficie</span></span>
<span id="cb88-2"><a href="ee.imagecollection-1.html#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> S2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;COPERNICUS/S2_SR&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cargar la colección de Sentinel-2 reflectancia de la superficie
var S2 = ee.ImageCollection('COPERNICUS/S2_SR');
</script>
<p>Como información adicional para este capítulo se definirá una geometría de un área de interés.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb89-1"><a href="ee.imagecollection-1.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Definición de un área de interés</span></span>
<span id="cb89-2"><a href="ee.imagecollection-1.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> roi <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>(</span>
<span id="cb89-3"><a href="ee.imagecollection-1.html#cb89-3" aria-hidden="true" tabindex="-1"></a>        [[[<span class="op">-</span><span class="fl">101.80582759131487</span><span class="op">,</span> <span class="fl">20.274503120947937</span>]<span class="op">,</span></span>
<span id="cb89-4"><a href="ee.imagecollection-1.html#cb89-4" aria-hidden="true" tabindex="-1"></a>          [<span class="op">-</span><span class="fl">101.80582759131487</span><span class="op">,</span> <span class="fl">19.35462236718103</span>]<span class="op">,</span></span>
<span id="cb89-5"><a href="ee.imagecollection-1.html#cb89-5" aria-hidden="true" tabindex="-1"></a>          [<span class="op">-</span><span class="fl">100.61930415381487</span><span class="op">,</span> <span class="fl">19.35462236718103</span>]<span class="op">,</span></span>
<span id="cb89-6"><a href="ee.imagecollection-1.html#cb89-6" aria-hidden="true" tabindex="-1"></a>          [<span class="op">-</span><span class="fl">100.61930415381487</span><span class="op">,</span> <span class="fl">20.274503120947937</span>]]]<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Definición de un área de interés
var roi = ee.Geometry.Polygon(
        [[[-101.80582759131487, 20.274503120947937],
          [-101.80582759131487, 19.35462236718103],
          [-100.61930415381487, 19.35462236718103],
          [-100.61930415381487, 20.274503120947937]]], null, false);
</script>
<div id="información-y-metadatos-4" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Información y metadatos<a href="ee.imagecollection-1.html#información-y-metadatos-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>
Las colecciones de imágenes contienen los metadatos e información de todas las imágenes que incluyen, lo cual permite filtrar las imágenes y utilizar únicamente las que cumplen con ciertos criterios. Es importante recalcar que los metadatos y propiedades de una colección de imágenes no corresponden a las propiedades de las imágenes que la componen. Para consultar las propiedades de una colección de imágenes se usa el método <code>.propertyNames</code> (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f101">10.1</a>).</p>
<p>Ejercicio 28.1</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb90-1"><a href="ee.imagecollection-1.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener las propiedades de la colección de imágenes</span></span>
<span id="cb90-2"><a href="ee.imagecollection-1.html#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> S2Prop <span class="op">=</span> S2<span class="op">.</span><span class="fu">propertyNames</span>()<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Obtener las propiedades de la colección de imágenes
var S2Prop = S2.propertyNames();
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f101"></span>
<img src="Img/s2properties.png" alt="Salida de la consola indicando las propiedades de la colección de imágenes de Sentinel-2 2A." width="60%" />
<p class="caption">
Figure 10.1: Salida de la consola indicando las propiedades de la colección de imágenes de Sentinel-2 2A.
</p>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>No se puede escribir o cambiar los objetos que se encuentran directamente hospedados en GEE. Por ejemplo, si se quiere mapear (<code>.map</code>) una función que sobreescriba alguna característica de las colecciones de imágenes en GEE, se debe hacer una copia de estas para que se pueda sobreescribir la propiedad de interés.</p>
</div>
</div>
</div>
<div id="creación-de-colecciones-de-imágenes" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Creación de colecciones de imágenes<a href="ee.imagecollection-1.html#creación-de-colecciones-de-imágenes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>
En ciertas ocasiones, el usuario puede estar interesado en crear nuevas colecciones de imágenes a partir de imágenes generadas dentro del mismo GEE. En este caso, se utiliza el método <code>ee.ImageCollection.fromImages</code>, indicando como argumentos la lista de las imágenes a partir de la que se quiere crear dicha colección (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f102">10.2</a>).</p>
<p>Ejercicio 28.2</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb91-1"><a href="ee.imagecollection-1.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Filtrar colección de Sentinel-2 por fechas</span></span>
<span id="cb91-2"><a href="ee.imagecollection-1.html#cb91-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> im1 <span class="op">=</span> S2<span class="op">.</span><span class="fu">filterDate</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span><span class="st">&#39;2019-05-01&#39;</span>)</span>
<span id="cb91-3"><a href="ee.imagecollection-1.html#cb91-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Aplicar filtro espacial</span></span>
<span id="cb91-4"><a href="ee.imagecollection-1.html#cb91-4" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">filterBounds</span>(roi)</span>
<span id="cb91-5"><a href="ee.imagecollection-1.html#cb91-5" aria-hidden="true" tabindex="-1"></a> <span class="co">// Obtener la primera imagen</span></span>
<span id="cb91-6"><a href="ee.imagecollection-1.html#cb91-6" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb91-7"><a href="ee.imagecollection-1.html#cb91-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-8"><a href="ee.imagecollection-1.html#cb91-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Crear otra imagen de igual manera que la imagen anterior, pero con </span></span>
<span id="cb91-9"><a href="ee.imagecollection-1.html#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co">// fechas distintas</span></span>
<span id="cb91-10"><a href="ee.imagecollection-1.html#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> im2 <span class="op">=</span> S2<span class="op">.</span><span class="fu">filterDate</span>(<span class="st">&#39;2020-01-01&#39;</span><span class="op">,</span><span class="st">&#39;2020-05-01&#39;</span>)</span>
<span id="cb91-11"><a href="ee.imagecollection-1.html#cb91-11" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">filterBounds</span>(roi)</span>
<span id="cb91-12"><a href="ee.imagecollection-1.html#cb91-12" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">first</span>()<span class="op">;</span></span>
<span id="cb91-13"><a href="ee.imagecollection-1.html#cb91-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-14"><a href="ee.imagecollection-1.html#cb91-14" aria-hidden="true" tabindex="-1"></a><span class="co">// Crear colección a partir de dos imágenes</span></span>
<span id="cb91-15"><a href="ee.imagecollection-1.html#cb91-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imColl <span class="op">=</span> ee<span class="op">.</span><span class="at">ImageCollection</span><span class="op">.</span><span class="fu">fromImages</span>([im1<span class="op">,</span> im2])<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Filtrar colección de Sentinel-2 por fechas
var im1 = S2.filterDate('2019-01-01','2019-05-01')
  // Aplicar filtro espacial
 .filterBounds(roi)
 // Obtener la primera imagen
 .first();

// Crear otra imagen de igual manera que la imagen anterior, pero con 
// fechas distintas
var im2 = S2.filterDate('2020-01-01','2020-05-01')
 .filterBounds(roi)
 .first();

// Crear colección a partir de dos imágenes
var imColl = ee.ImageCollection.fromImages([im1, im2]);
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f102"></span>
<img src="Img/imcolnew.png" alt="Salida de la consola indicando el contenido de las dos imágenes obtenidas mediante un filtrado temporal distinto, así como la combinación de ambas en una colección de imágenes." width="60%" />
<p class="caption">
Figure 10.2: Salida de la consola indicando el contenido de las dos imágenes obtenidas mediante un filtrado temporal distinto, así como la combinación de ambas en una colección de imágenes.
</p>
</div>
</div>
<div id="visualización-de-colecciones-de-imágenes" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Visualización de colecciones de imágenes<a href="ee.imagecollection-1.html#visualización-de-colecciones-de-imágenes" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>
Así como curre con los vectores y las colecciones de vectores, las colecciones de imágenes se pueden visualizar en la pantalla de mapa mediante la función <code>Map.addLayer</code>. Usualmente, al agregar una colección de imágenes a la pantalla de mapa se van a mostrar los elementos con fecha de registro más reciente. Por ejemplo, en este caso muestra la imagen más reciente por cada escena dentro de la colección (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f103">10.3</a>).</p>
<p>Ejercicio 28.3</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb92-1"><a href="ee.imagecollection-1.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Filtrar colección de Sentinel-2 utilizando fechas</span></span>
<span id="cb92-2"><a href="ee.imagecollection-1.html#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imCol3 <span class="op">=</span> S2<span class="op">.</span><span class="fu">filterDate</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span><span class="st">&#39;2019-05-01&#39;</span>)</span>
<span id="cb92-3"><a href="ee.imagecollection-1.html#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Aplicar filtro espacial</span></span>
<span id="cb92-4"><a href="ee.imagecollection-1.html#cb92-4" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">filterBounds</span>(roi)<span class="op">;</span></span>
<span id="cb92-5"><a href="ee.imagecollection-1.html#cb92-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-6"><a href="ee.imagecollection-1.html#cb92-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Agregar colección de imágenes a la pantalla de mapa</span></span>
<span id="cb92-7"><a href="ee.imagecollection-1.html#cb92-7" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(imCol3<span class="op">,</span> {<span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span><span class="st">&#39;B3&#39;</span><span class="op">,</span><span class="st">&#39;B2&#39;</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span><span class="dv">200</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">2000</span>}<span class="op">,</span> </span>
<span id="cb92-8"><a href="ee.imagecollection-1.html#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;S2 Mich&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Filtrar colección de Sentinel-2 utilizando fechas
var imCol3 = S2.filterDate('2019-01-01','2019-05-01')
  // Aplicar filtro espacial
 .filterBounds(roi);

// Agregar colección de imágenes a la pantalla de mapa
Map.addLayer(imCol3, {bands: ['B4','B3','B2'], min:200, max: 2000}, 
  'S2 Mich');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f103"></span>
<img src="Img/visS2Mich.png" alt="Visualización de la colección de imágenes de Sentinel-2 2A." width="60%" />
<p class="caption">
Figure 10.3: Visualización de la colección de imágenes de Sentinel-2 2A.
</p>
</div>
</div>
<div id="métodos-comunes-4" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Métodos comunes<a href="ee.imagecollection-1.html#métodos-comunes-4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="filtración-de-colecciones-de-imágenes" class="section level3 unnumbered hasAnchor">
<h3>Filtración de colecciones de imágenes<a href="ee.imagecollection-1.html#filtración-de-colecciones-de-imágenes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Las colecciones de imágenes se pueden filtrar a partir de los metadatos de las imágenes que contienen. De tal manera, se puede filtrar por: superposición con algún polígono de interés, fecha de registro, metadatos de las escenas (path, row, porcentaje de nubosidad), entre otras. Para filtrar una colección de imágenes se van a utilizar los objetos <code>ee.Filter</code>. Existen diversos tipos de filtros, algunos ya se encuentran precargados, pero otros se pueden definir manualmente. Por ejemplo, para filtrar por fecha se puede utilizar <code>.filterDate</code> (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f104">10.4</a>):</p>
<p>Ejercicio 28.4</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb93-1"><a href="ee.imagecollection-1.html#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Filtrar colección de imágenes por fecha</span></span>
<span id="cb93-2"><a href="ee.imagecollection-1.html#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imCol4 <span class="op">=</span> S2<span class="op">.</span><span class="fu">filterDate</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span><span class="st">&#39;2019-05-01&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Filtrar colección de imágenes por fecha
var imCol4 = S2.filterDate('2019-01-01','2019-05-01');
</script>
<p>Por otro lado, mediante <code>.filterBounds</code> se puede filtrar espacialmente con un polígono.:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb94-1"><a href="ee.imagecollection-1.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Filtrar colección de acuerdo a sobreponga con polígono de región de </span></span>
<span id="cb94-2"><a href="ee.imagecollection-1.html#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co">// interés</span></span>
<span id="cb94-3"><a href="ee.imagecollection-1.html#cb94-3" aria-hidden="true" tabindex="-1"></a>imCol4 <span class="op">=</span> imCol4<span class="op">.</span><span class="fu">filterBounds</span>(roi)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Filtrar colección de acuerdo a sobreponga con polígono de región de 
// interés
imCol4 = imCol4.filterBounds(roi);
</script>
<p>
Si se desea filtrar por alguna característica de los metadatos de las imágenes se puede hacer mediante <code>.filter</code> y después definiendo el filtro del metadato con <code>ee.Filter</code>. Otra forma de realizar este proceso es mediante <code>.filterMetadata</code>. Las siguientes dos líneas son equivalentes ya que obtienen el mismo resultado.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb95-1"><a href="ee.imagecollection-1.html#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener el nombre de las propiedades de una imagen de la colección de </span></span>
<span id="cb95-2"><a href="ee.imagecollection-1.html#cb95-2" aria-hidden="true" tabindex="-1"></a><span class="co">// imágenes</span></span>
<span id="cb95-3"><a href="ee.imagecollection-1.html#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imProperties <span class="op">=</span> im1<span class="op">.</span><span class="fu">propertyNames</span>()<span class="op">;</span></span>
<span id="cb95-4"><a href="ee.imagecollection-1.html#cb95-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-5"><a href="ee.imagecollection-1.html#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Filtrar a partir de las propiedades de las imágenes</span></span>
<span id="cb95-6"><a href="ee.imagecollection-1.html#cb95-6" aria-hidden="true" tabindex="-1"></a>imCol4 <span class="op">=</span> imCol4<span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lt</span>(<span class="st">&#39;CLOUD_COVERAGE_ASSESSMENT&#39;</span><span class="op">,</span> <span class="dv">50</span>))<span class="op">;</span></span>
<span id="cb95-7"><a href="ee.imagecollection-1.html#cb95-7" aria-hidden="true" tabindex="-1"></a>imCol4 <span class="op">=</span> imCol4<span class="op">.</span><span class="fu">filterMetadata</span>(<span class="st">&#39;CLOUD_COVERAGE_ASSESSMENT&#39;</span><span class="op">,</span><span class="st">&#39;less_than&#39;</span><span class="op">,</span> <span class="dv">50</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Obtener el nombre de las propiedades de una imagen de la colección de 
// imágenes
var imProperties = im1.propertyNames();

// Filtrar a partir de las propiedades de las imágenes
imCol4 = imCol4.filter(ee.Filter.lt('CLOUD_COVERAGE_ASSESSMENT', 50));
imCol4 = imCol4.filterMetadata('CLOUD_COVERAGE_ASSESSMENT','less_than', 50);
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f104"></span>
<img src="Img/filtroEspacialTemporal.png" alt="Salida de la consola indicando los resultados de la colección de imágenes después de realizar diferentes tipos de filtros." width="60%" />
<p class="caption">
Figure 10.4: Salida de la consola indicando los resultados de la colección de imágenes después de realizar diferentes tipos de filtros.
</p>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>Recuerde que para filtrar una colección de imágenes utilizando metadatos se debe filtrar de acuerdo a las propiedades de las imágenes, no de la colección.</p>
</div>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>Para trabajar con una colección de imágenes se sugiere que primero se apliquen los filtros espaciales y temporales (<code>.filter</code>), así como la selección de las bandas a utilizar (<code>.select</code>), antes de realizar operaciones sobre todas las imágenes de la colección (<code>.map</code>).</p>
</div>
</div>
<p>
</p>
<div class="bluebox2">
<div class="awesomeblock">
<p>Para combinar varios filtros se utiliza <code>ee.Filter.and</code> o <code>ee.Filter.or</code> dependiendo de si se desea que se cumplan todas las condiciones indicadas (<code>and</code>) o alguna de ellas (<code>or</code>).</p>
</div>
</div>
</div>
<div id="selección-de-bandas-1" class="section level3 unnumbered hasAnchor">
<h3>Selección de bandas<a href="ee.imagecollection-1.html#selección-de-bandas-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Al igual que con las imágenes, se puede utilizar el método <code>.select</code> para seleccionar un conjunto de bandas de todas las imágenes que se encuentran en la colección. De igual manera que como ocurre con las imágenes individuales, para seleccionar una única banda solo se requiere indicar el nombre de esta, mientras que si se desea seleccionar varias bandas, estas deben indicarse dentro de una lista. Por ejemplo (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f105">10.5</a>):</p>
<p>Ejercicio 28.5</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb96-1"><a href="ee.imagecollection-1.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener el nombre de las bandas de una imagen de una colección de </span></span>
<span id="cb96-2"><a href="ee.imagecollection-1.html#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="co">// imágenes</span></span>
<span id="cb96-3"><a href="ee.imagecollection-1.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imBandNames <span class="op">=</span> im1<span class="op">.</span><span class="fu">bandNames</span>()<span class="op">;</span></span>
<span id="cb96-4"><a href="ee.imagecollection-1.html#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="ee.imagecollection-1.html#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Seleccionar ciertas bandas de todas las imágenes que conforman la </span></span>
<span id="cb96-6"><a href="ee.imagecollection-1.html#cb96-6" aria-hidden="true" tabindex="-1"></a><span class="co">// colección</span></span>
<span id="cb96-7"><a href="ee.imagecollection-1.html#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imCol5 <span class="op">=</span> imCol4<span class="op">.</span><span class="fu">select</span>([<span class="st">&#39;B4&#39;</span><span class="op">,</span><span class="st">&#39;B3&#39;</span><span class="op">,</span><span class="st">&#39;B2&#39;</span>])<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Obtener el nombre de las bandas de una imagen de una colección de 
// imágenes
var imBandNames = im1.bandNames();

// Seleccionar ciertas bandas de todas las imágenes que conforman la 
// colección
var imCol5 = imCol4.select(['B4','B3','B2']);
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f105"></span>
<img src="Img/imBandNames1.png" alt="Salida de la consola indicando los nombres de las bandas de las imágenes Sentinel-2, así como de la selección únicamente de las bandas 4, 3 y 2." width="60%" />
<p class="caption">
Figure 10.5: Salida de la consola indicando los nombres de las bandas de las imágenes Sentinel-2, así como de la selección únicamente de las bandas 4, 3 y 2.
</p>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>Recuerde que para seleccionar ciertas bandas en una colección de imágenes, estas corresponden a bandas de las imágenes, no de la colección. Esto es útil para revisar los nombres de las bandas.</p>
</div>
</div>
</div>
<div id="ordenación-de-una-colección" class="section level3 unnumbered hasAnchor">
<h3>Ordenación de una colección<a href="ee.imagecollection-1.html#ordenación-de-una-colección" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
El método <code>.sort</code> permite ordenar una colección de imágenes por alguna propiedad de estas. Por defecto, las colecciones de imágenes están ordenadas cronológicamente. Sin embargo, se puede cambiar este orden para que las presente por alguna característica de las imágenes, por ejemplo, por orden de menor a mayor cobertura de nubes. Por defecto, el método <code>.sort</code> ordena la colección de imágenes de forma ascendente, de acuerdo al valor de la característica indicada. Si se desea ordenar de manera descendente, esto se puede indicar utilizando el argumento <code>ascending: false</code>. En el siguiente ejemplo, primero se ordena la colección en orden ascendente y en el segundo, descendente.</p>
<p>Ejercicio 28.6</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb97-1"><a href="ee.imagecollection-1.html#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cambiar el orden de la colección en función de la propiedad de las </span></span>
<span id="cb97-2"><a href="ee.imagecollection-1.html#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="co">// imágenes de cobertura de nubes en sentido descendente</span></span>
<span id="cb97-3"><a href="ee.imagecollection-1.html#cb97-3" aria-hidden="true" tabindex="-1"></a>imCol5 <span class="op">=</span> imCol5<span class="op">.</span><span class="fu">sort</span>({<span class="dt">property</span><span class="op">:</span> <span class="st">&#39;CLOUD_COVERAGE_ASSESSMENT&#39;</span><span class="op">,</span> </span>
<span id="cb97-4"><a href="ee.imagecollection-1.html#cb97-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">ascending</span><span class="op">:</span> <span class="kw">false</span>})<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cambiar el orden de la colección en función de la propiedad de las 
// imágenes de cobertura de nubes en sentido descendente
imCol5 = imCol5.sort({property: 'CLOUD_COVERAGE_ASSESSMENT', 
  ascending: false});
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f106"></span>
<img src="Img/imcol5sortcloud.png" alt="Visualización de la primera imagen de la colección." width="60%" />
<p class="caption">
Figure 10.6: Visualización de la primera imagen de la colección.
</p>
</div>
</div>
<div id="obtención-de-la-primera-imagen" class="section level3 unnumbered hasAnchor">
<h3>Obtención de la primera imagen<a href="ee.imagecollection-1.html#obtención-de-la-primera-imagen" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
En algunas ocasiones resulta útil obtener la primera imagen de una colección de imágenes para ver si se llevó a cabo el procedimiento deseado sobre la colección. Para ello, se utiliza el método <code>.first</code>, que devuelve la primera imagen que se encuentra en la colección y permite visualizarla en la pantalla de mapa para analizarla más a detalle. Al utilizar el método <code>.first</code> sobre una colección de imágenes (<code>ee.ImageCollection</code>) el resultado corresponderá a una imagen (<code>ee.Image</code>; <span style="color: darkblue;">Fig. </span> <a href="ee.imagecollection-1.html#fig:f107">10.7</a>).</p>
<p>Ejercicio 28.7</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb98-1"><a href="ee.imagecollection-1.html#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener la primera imagen de una colección</span></span>
<span id="cb98-2"><a href="ee.imagecollection-1.html#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> primera <span class="op">=</span> imCol3<span class="op">.</span><span class="fu">first</span>()</span></code></pre></div>
<script type="text/javascript">
// Obtener la primera imagen de una colección
var primera = imCol3.first()
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f107"></span>
<img src="Img/primerIm.png" alt="Salida de la consola indicando la primera imagen de la colección." width="60%" />
<p class="caption">
Figure 10.7: Salida de la consola indicando la primera imagen de la colección.
</p>
</div>
</div>
<div id="extracción-de-listas-con-atributos-de-imágenes" class="section level3 unnumbered hasAnchor">
<h3>Extracción de listas con atributos de imágenes<a href="ee.imagecollection-1.html#extracción-de-listas-con-atributos-de-imágenes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Para obtener una lista con los atributos de las imágenes que conforman una colección de imágenes se utiliza el método <code>.aggregate</code>. Este método tiene varias formas de obtener y resumir los atributos de los vectores que conforman una colección: extraer una propiedad de los vectores (<code>.aggregate_array</code>), extraer y calcular la media por propiedad (<code>.aggregate_mean</code>), extraer y calcular un histograma (<code>.aggregate_histogram</code>) o extraer y obtener estadísticas descriptivas de las propiedades (<code>.aggregate_stats</code>). Por ejemplo, una lista con la propiedad ‘CLOUD_COVERAGE_ASSESSMENT’ de todas las imágenes contenidas en una colección de imágenes se puede obtener de la siguiente manera (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f108">10.8</a>):</p>
<p>Ejercicio 28.8</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb99-1"><a href="ee.imagecollection-1.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener una lista de con los valores de la propiedad de cobertura de </span></span>
<span id="cb99-2"><a href="ee.imagecollection-1.html#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="co">// nubes de todas las imágenes de la colección</span></span>
<span id="cb99-3"><a href="ee.imagecollection-1.html#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> listMetadatos <span class="op">=</span> imCol5<span class="op">.</span><span class="fu">aggregate_array</span>(<span class="st">&#39;CLOUD_COVERAGE_ASSESSMENT&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Obtener una lista de con los valores de la propiedad de cobertura de 
// nubes de todas las imágenes de la colección
var listMetadatos = imCol5.aggregate_array('CLOUD_COVERAGE_ASSESSMENT');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f108"></span>
<img src="Img/cloudCoverList.png" alt="Salida de la consola indicando la lista de propiedades de las imágenes." width="60%" />
<p class="caption">
Figure 10.8: Salida de la consola indicando la lista de propiedades de las imágenes.
</p>
</div>
</div>
<div id="conteo-de-observaciones-por-píxel" class="section level3 unnumbered hasAnchor">
<h3>Conteo de observaciones por píxel<a href="ee.imagecollection-1.html#conteo-de-observaciones-por-píxel" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Para conocer el número de valores sin enmascarar por píxel en la colección de imágenes se utiliza el método <code>.count</code>. El resultado de este procedimiento consta de una imagen con las mismas bandas que las imágenes a partir de las cuales se calculó el número de observaciones por píxel (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f109">10.9</a>).</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb100-1"><a href="ee.imagecollection-1.html#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener el número de observaciones válidas para un píxel dentro de una </span></span>
<span id="cb100-2"><a href="ee.imagecollection-1.html#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="co">// colección de imágenes</span></span>
<span id="cb100-3"><a href="ee.imagecollection-1.html#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> conteoImgs <span class="op">=</span> imCol5<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Obtener el número de observaciones válidas para un píxel dentro de una 
// colección de imágenes
var conteoImgs = imCol5.count();
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f109"></span>
<img src="Img/conteoim.png" alt="Visualización de la imagen del conteo de observaciones." width="60%" />
<p class="caption">
Figure 10.9: Visualización de la imagen del conteo de observaciones.
</p>
</div>
</div>
<div id="conocer-el-tamaño-de-la-colección" class="section level3 unnumbered hasAnchor">
<h3>Conocer el tamaño de la colección<a href="ee.imagecollection-1.html#conocer-el-tamaño-de-la-colección" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Para conocer el tamaño de la colección en número de imágenes incluidas se utiliza el método <code>.size</code>.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb101-1"><a href="ee.imagecollection-1.html#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener el número de observaciones válidas para un píxel dentro de una </span></span>
<span id="cb101-2"><a href="ee.imagecollection-1.html#cb101-2" aria-hidden="true" tabindex="-1"></a><span class="co">// colección de imágenes</span></span>
<span id="cb101-3"><a href="ee.imagecollection-1.html#cb101-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> numImgs <span class="op">=</span> imCol5<span class="op">.</span><span class="fu">size</span>()<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Obtener el número de observaciones válidas para un píxel dentro de una 
// colección de imágenes
var numImgs = imCol5.size();
</script>
</div>
<div id="unión-de-más-de-una-colección" class="section level3 unnumbered hasAnchor">
<h3>Unión de más de una colección<a href="ee.imagecollection-1.html#unión-de-más-de-una-colección" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Para unir una colección de imágenes con otra, se utiliza el método <code>.merge</code>. Un caso típico de tal operación sería unir dos colecciones de Landsat, por ejemplo, Landsat 7 y 8.</p>
<div class="bluebox2">
<div class="awesomeblock">
<p>Las colecciones Landsat 7 y 8 no tienen las mismas bandas, ni los nombres de las bandas corresponden entre sí. Por ejemplo, la banda 1 de Landsat 7 corresponde al espectro del azul (<em>blue</em>), mientras que en Landsat 8, la banda 1 corresponde al azul de costa (<em>coastal blue</em>). En este caso, conviene primero filtrar y renombrar las bandas a unir para asegurarse de que el nombre de las bandas a unir en una colección corresponda con el de la otra.</p>
</div>
</div>
<p>La unión de una colección de Sentinel-2 se podría hacer de la siguiente manera (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1010">10.10</a>):</p>
<p>Ejercicio 28.9</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb102-1"><a href="ee.imagecollection-1.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Aplicar un filtro por fechas a la colección de Sentinel-2</span></span>
<span id="cb102-2"><a href="ee.imagecollection-1.html#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imCol6 <span class="op">=</span> S2<span class="op">.</span><span class="fu">filterDate</span>(<span class="st">&#39;2019-01-01&#39;</span><span class="op">,</span><span class="st">&#39;2019-05-01&#39;</span>)</span>
<span id="cb102-3"><a href="ee.imagecollection-1.html#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Aplicar filtro espacial</span></span>
<span id="cb102-4"><a href="ee.imagecollection-1.html#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(roi)<span class="op">;</span></span>
<span id="cb102-5"><a href="ee.imagecollection-1.html#cb102-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-6"><a href="ee.imagecollection-1.html#cb102-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Hacer lo mismo que en el caso anterior, pero cambiando las fechas</span></span>
<span id="cb102-7"><a href="ee.imagecollection-1.html#cb102-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imCol7 <span class="op">=</span> S2<span class="op">.</span><span class="fu">filterDate</span>(<span class="st">&#39;2020-06-01&#39;</span><span class="op">,</span><span class="st">&#39;2020-11-01&#39;</span>)</span>
<span id="cb102-8"><a href="ee.imagecollection-1.html#cb102-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterBounds</span>(roi)<span class="op">;</span></span>
<span id="cb102-9"><a href="ee.imagecollection-1.html#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="ee.imagecollection-1.html#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Unir las dos colecciones de imágenes en una sola  </span></span>
<span id="cb102-11"><a href="ee.imagecollection-1.html#cb102-11" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imCol8 <span class="op">=</span> imCol6<span class="op">.</span><span class="fu">merge</span>(imCol7)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Aplicar un filtro por fechas a la colección de Sentinel-2
var imCol6 = S2.filterDate('2019-01-01','2019-05-01')
  // Aplicar filtro espacial
  .filterBounds(roi);

// Hacer lo mismo que en el caso anterior, pero cambiando las fechas
var imCol7 = S2.filterDate('2020-06-01','2020-11-01')
  .filterBounds(roi);

// Unir las dos colecciones de imágenes en una sola  
var imCol8 = imCol6.merge(imCol7);
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1010"></span>
<img src="Img/merge2colecciones.png" alt="Salida de la consola indicando el número de elementos en cada colección, así como el número de elementos en la colección combinada." width="60%" />
<p class="caption">
Figure 10.10: Salida de la consola indicando el número de elementos en cada colección, así como el número de elementos en la colección combinada.
</p>
</div>
</div>
<div id="ejecución-de-una-función-sobre-todas-las-imágenes-de-una-colección" class="section level3 unnumbered hasAnchor">
<h3>Ejecución de una función sobre todas las imágenes de una colección<a href="ee.imagecollection-1.html#ejecución-de-una-función-sobre-todas-las-imágenes-de-una-colección" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Para realizar alguna operación sobre todas las imágenes de una <code>ee.ImageCollection</code> se utiliza el método <code>.map</code>. Esto va a aplicar el procedimiento o función que se defina en el interior de ella, a cada imagen dentro de la colección. Por ejemplo, si quisiéramos agregar una banda con un índice de vegetación a todas las imágenes, se podría hacer de la siguiente manera (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1011">10.11</a>):</p>
<p>Ejercicio 28.10</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb103-1"><a href="ee.imagecollection-1.html#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Definir una función que calcule el ndvi de una imagen</span></span>
<span id="cb103-2"><a href="ee.imagecollection-1.html#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndviCalc <span class="op">=</span> <span class="kw">function</span>(image){</span>
<span id="cb103-3"><a href="ee.imagecollection-1.html#cb103-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calcular el ndvi utilizando las bandas del NIR, B8 y R, B4</span></span>
<span id="cb103-4"><a href="ee.imagecollection-1.html#cb103-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B8&#39;</span><span class="op">,</span><span class="st">&#39;B4&#39;</span>])<span class="op">;</span></span>
<span id="cb103-5"><a href="ee.imagecollection-1.html#cb103-5" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Regresar la imagen con la nueva banda de ndvi</span></span>
<span id="cb103-6"><a href="ee.imagecollection-1.html#cb103-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(ndvi)<span class="op">;</span></span>
<span id="cb103-7"><a href="ee.imagecollection-1.html#cb103-7" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb103-8"><a href="ee.imagecollection-1.html#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="ee.imagecollection-1.html#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Aplicar la función sobre todas las imágenes de una colección</span></span>
<span id="cb103-10"><a href="ee.imagecollection-1.html#cb103-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imCol9 <span class="op">=</span> imCol4<span class="op">.</span><span class="fu">map</span>(ndviCalc)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Definir una función que calcule el ndvi de una imagen
var ndviCalc = function(image){
  // Calcular el ndvi utilizando las bandas del NIR, B8 y R, B4
  var ndvi = image.normalizedDifference(['B8','B4']);
  // Regresar la imagen con la nueva banda de ndvi
  return image.addBands(ndvi);
};

// Aplicar la función sobre todas las imágenes de una colección
var imCol9 = imCol4.map(ndviCalc);
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1011"></span>
<img src="Img/imcol9.png" alt="Salida de la consola con la información de la colección de imágenes con la banda NDVI agregada a cada imagen." width="60%" />
<p class="caption">
Figure 10.11: Salida de la consola con la información de la colección de imágenes con la banda NDVI agregada a cada imagen.
</p>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>Nótese que el método <code>.map</code> es distinto de la función <code>Map</code> que permite agregar objetos a la pantalla de mapa. Recuerde que JavaScript es un lenguaje sensible a mayúsculas y minúsculas.</p>
</div>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>GEE recomienda el uso de <code>.map</code> para realizar operaciones de tipo ciclo, en lugar de otras funciones de ciclo (por ejemplo, <code>for</code>).</p>
</div>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>El método <code>.map</code> requiere del uso de funciones del lado del servidor, así que se recomienda evitar el uso de funciones del lado del cliente como <code>print</code>, <code>Map</code>, <code>Export</code> y <code>Chart</code>.</p>
</div>
</div>
</div>
<div id="reducción-de-una-colección-de-imágenes" class="section level3 unnumbered hasAnchor">
<h3>Reducción de una colección de imágenes<a href="ee.imagecollection-1.html#reducción-de-una-colección-de-imágenes" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Los reductores permiten crear un compuesto (una sola imagen) a partir de una colección de imágenes. Por ello, el resultado obtenido tras una reducción sobre una colección de imágenes (<code>ee.ImageCollection</code>) será una imagen (<code>ee.Image</code>). Los reductores son muy útiles para hacer mosaicos multitemporales u obtener información de la colección de imágenes. Para reducir una colección de imágenes se utilizará el método <code>.reduce</code>, indicando la operación matemática a utilizar mediante un objeto tipo <code>ee.Reducer</code>. De tal manera, se puede indicar si el resultado corresponderá a la media; <code>ee.Reducer.mean</code>, mediana; <code>ee.Reducer.median</code>, moda; <code>ee.Reducer.mode</code>, mínimo, <code>ee.Reducer.min</code>, máximo; <code>ee.Reducer.max</code> o inclusive la media de un intervalo determinado de observaciones, <code>ee.Reducer.intervalMean</code>. Otra forma de realizar estas mismas reducciones es utilizando directamente los métodos de <code>.min</code>, <code>.max</code>, <code>.mean</code>, <code>.mode</code>, <code>.median</code>. Las siguientes dos líneas realizan exactamente el mismo proceso (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1012">10.12</a>):</p>
<p>Ejercicio 28.11</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb104-1"><a href="ee.imagecollection-1.html#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Calcular el valor promedio de reflectancia para cada una de las bandas </span></span>
<span id="cb104-2"><a href="ee.imagecollection-1.html#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co">// de las imágenes que conforman la colección</span></span>
<span id="cb104-3"><a href="ee.imagecollection-1.html#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imRedMean <span class="op">=</span> imCol9<span class="op">.</span><span class="fu">mean</span>()<span class="op">;</span></span>
<span id="cb104-4"><a href="ee.imagecollection-1.html#cb104-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-5"><a href="ee.imagecollection-1.html#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Realizar lo mismo, pero utilizando explícitamente la definición del </span></span>
<span id="cb104-6"><a href="ee.imagecollection-1.html#cb104-6" aria-hidden="true" tabindex="-1"></a><span class="co">// reductor</span></span>
<span id="cb104-7"><a href="ee.imagecollection-1.html#cb104-7" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imRedMean2 <span class="op">=</span> imCol9<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>())<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Calcular el valor promedio de reflectancia para cada una de las bandas 
// de las imágenes que conforman la colección
var imRedMean = imCol9.mean();

// Realizar lo mismo, pero utilizando explícitamente la definición del 
// reductor
var imRedMean2 = imCol9.reduce(ee.Reducer.mean());
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1012"></span>
<img src="Img/imredmean.png" alt="Visualización de la imagen de la reflectancia promedio (compuesto RGB)." width="60%" />
<p class="caption">
Figure 10.12: Visualización de la imagen de la reflectancia promedio (compuesto RGB).
</p>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>Al aplicar una reducción a una colección de imágenes mediante el método <code>.reduce</code>, el nombre de las bandas será el mismo que el de las bandas de cada imagen con un sufijo que indica la operación matemática utilizada para hacer la reducción. Por ejemplo, al utilizar <code>ee.Reducer.mean</code> sobre una colección de imágenes cuyas bandas se llaman ‘B1’ y ‘B2’, las bandas de la imagen producto de la reducción se llamarán ‘B1_mean’ y ‘B2_mean’.</p>
</div>
</div>
</div>
<div id="creación-de-compuestos-y-mosaicos" class="section level3 unnumbered hasAnchor">
<h3>Creación de compuestos y mosaicos<a href="ee.imagecollection-1.html#creación-de-compuestos-y-mosaicos" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>
Si se desea hacer mosaicos a partir de varias imágenes se puede realizar en GEE mediante dos métodos: <code>.mosaic</code> y <code>.qualityMosaic</code>. La principal diferencia entre estos dos procesos radica en que la primera simplemente pega las imágenes de acuerdo al orden que tienen en la colección (es decir, la última hasta arriba). Por el contrario, el método de <code>.qualityMosaic</code> permite priorizar el píxel que quedará en el mosaico final a partir del valor más alto de alguna banda. Esto puede ser útil para realizar, por ejemplo, un mosaico del píxel con mayor valor de NDVI. En el caso de <code>.qualityMosaic</code> hay que indicar la banda que se utilizará como la banda de calidad para crear el mosaico (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1013">10.13</a>).</p>
<p>Ejercicio 28.12</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb105-1"><a href="ee.imagecollection-1.html#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Crear un mosaico de las imágenes contenidas en una colección. </span></span>
<span id="cb105-2"><a href="ee.imagecollection-1.html#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="co">// Generalmente en áreas de sobreposición se tomarán los valores de las </span></span>
<span id="cb105-3"><a href="ee.imagecollection-1.html#cb105-3" aria-hidden="true" tabindex="-1"></a><span class="co">// imágenes más recientes</span></span>
<span id="cb105-4"><a href="ee.imagecollection-1.html#cb105-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imRedMosaic <span class="op">=</span> imCol9<span class="op">.</span><span class="fu">mosaic</span>()<span class="op">;</span></span>
<span id="cb105-5"><a href="ee.imagecollection-1.html#cb105-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-6"><a href="ee.imagecollection-1.html#cb105-6" aria-hidden="true" tabindex="-1"></a><span class="co">// Crear un mosaico utilizando como banda de calidad &#39;nd&#39; que en este caso</span></span>
<span id="cb105-7"><a href="ee.imagecollection-1.html#cb105-7" aria-hidden="true" tabindex="-1"></a><span class="co">//corresponde al ndvi</span></span>
<span id="cb105-8"><a href="ee.imagecollection-1.html#cb105-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Este método permite obtener mosaicos, por ejemplo, del valor del píxel</span></span>
<span id="cb105-9"><a href="ee.imagecollection-1.html#cb105-9" aria-hidden="true" tabindex="-1"></a><span class="co">//de mayor verdor o mayor valor de ndvi</span></span>
<span id="cb105-10"><a href="ee.imagecollection-1.html#cb105-10" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imRedQualMosaic <span class="op">=</span> imCol9<span class="op">.</span><span class="fu">qualityMosaic</span>(<span class="st">&#39;nd&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Crear un mosaico de las imágenes contenidas en una colección. 
// Generalmente en áreas de sobreposición se tomarán los valores de las 
// imágenes más recientes
var imRedMosaic = imCol9.mosaic();

// Crear un mosaico utilizando como banda de calidad 'nd' que en este caso
//corresponde al ndvi
// Este método permite obtener mosaicos, por ejemplo, del valor del píxel
//de mayor verdor o mayor valor de ndvi
var imRedQualMosaic = imCol9.qualityMosaic('nd');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1013"></span>
<img src="Img/imredmeanQM.png" alt="Visualización de la imagen de la reflectancia promedio con el método de mosaico de calidad (compuesto RGB)." width="60%" />
<p class="caption">
Figure 10.13: Visualización de la imagen de la reflectancia promedio con el método de mosaico de calidad (compuesto RGB).
</p>
</div>
<div id="ejercicio-b-filtro-de-colección-de-imágenes-y-visualización" class="section level4 unnumbered hasAnchor">
<h4>Ejercicio B: Filtro de colección de imágenes y visualización<a href="ee.imagecollection-1.html#ejercicio-b-filtro-de-colección-de-imágenes-y-visualización" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Este ejercicio integra elementos de los ejercicios 28.4, 28.5, 28.6 y 28.7, de modo que sea posible remitirse a estos ejercicios si se tienen dudas.</p>
<p>En un solo paso, aplicando múltiples filtros, se puede filtrar la colección de reflectancia de la superficie de imágenes de Landsat 8 de mayor calidad (<em>tier 1</em>) por fecha, porcentaje de cobertura de nubes de las imágenes, así como por su <em>path</em> y <em>row</em>. Para ello, primero se indica la ruta de la colección que se desea utilizar. Para encontrar esta ruta se puede buscar la colección de interés en la barra de búsqueda (<strong>Search</strong>), después se le da clic y del lado izquierdo aparecerá la ruta de la colección. Por otro lado, en esta misma ventana, en la pestaña de <strong>BANDS</strong> se pueden consultar las bandas y los nombres de las bandas que contiene cada imagen. Por su parte, en la pestaña de <strong>IMAGE PROPERTIES</strong> se pueden consultar los metadatos que contienen las imágenes de esta colección (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1014">10.14</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1014"></span>
<img src="Img/Ruta_coleccion.png" alt="Consulta de propiedades de las imágenes contenidas en una colección de imágenes." width="80%" />
<p class="caption">
Figure 10.14: Consulta de propiedades de las imágenes contenidas en una colección de imágenes.
</p>
</div>
<p>Una vez que se conoce la ruta de la colección de interés, se llama dicha colección y se especifican los filtros. En este caso, primero se filtra por fecha, en formato AAAA-MM-DD (año, mes, día), seguido de filtros de los metadatos de las imágenes:</p>
<ul>
<li>‘CLOUD_COVER_LAND’.</li>
<li>‘WRS_PATH’.</li>
<li>‘WRS_ROW’.</li>
</ul>
<p>Para realizar este filtro se debe escribir exactamente igual el nombre de las propiedades (por ejemplo, ‘CLOUD_COVER_LAND’) y en la definición del filtro se debe explicitar si se desea utilizar los valores que sean iguales (<code>.eq</code>), distintos (<code>.neq</code>), mayores (<code>.gt</code>), menores (<code>.lt</code>), mayores o igual (<code>.gte</code>) o menores o igual (<code>.lte</code>).
</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb106-1"><a href="ee.imagecollection-1.html#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Filtrado de la colección</span></span>
<span id="cb106-2"><a href="ee.imagecollection-1.html#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> L8imgCol <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;LANDSAT/LC08/C01/T1_SR&#39;</span>)</span>
<span id="cb106-3"><a href="ee.imagecollection-1.html#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterDate</span>(<span class="st">&#39;2015-01-01&#39;</span><span class="op">,</span><span class="st">&#39;2016-01-01&#39;</span>)</span>
<span id="cb106-4"><a href="ee.imagecollection-1.html#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">&#39;CLOUD_COVER_LAND&#39;</span><span class="op">,</span><span class="dv">50</span>))</span>
<span id="cb106-5"><a href="ee.imagecollection-1.html#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;WRS_PATH&#39;</span><span class="op">,</span><span class="dv">28</span>))</span>
<span id="cb106-6"><a href="ee.imagecollection-1.html#cb106-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;WRS_ROW&#39;</span><span class="op">,</span><span class="dv">46</span>))<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Filtrado de la colección
var L8imgCol = ee.ImageCollection('LANDSAT/LC08/C01/T1_SR')
  .filterDate('2015-01-01','2016-01-01')
  .filter(ee.Filter.lte('CLOUD_COVER_LAND',50))
  .filter(ee.Filter.eq('WRS_PATH',28))
  .filter(ee.Filter.eq('WRS_ROW',46));
</script>
<p>Para explorar algunas características de la colección de imágenes filtradas podemos escribir el siguiente comando y ver sus características en la consola.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb107-1"><a href="ee.imagecollection-1.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(L8imgCol)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
print(L8imgCol);
</script>
<p>Una vez pasado el comando anterior, en la consola se puede consultar cuántas imágenes cumplieron con los filtros indicados. En este ejemplo, la colección filtrada incluye 17 imágenes. Después, se pueden consultar las características de las imágenes. Para ello, en la consola se le da:</p>
<ul>
<li>Un clic a la colección en la consola.</li>
<li>Luego un clic a <strong>features</strong>.</li>
<li>Después un clic a cualquier imagen (<code>Image</code>).</li>
<li>Por último a <strong>Properties</strong>. Ahí se pueden ver los metadatos de cada imagen, y por lo tanto, los campos de información que se pueden utilizar para filtrar una colección de imágenes. Esta información es la misma que se puede obtener en la barra de búsqueda (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1015">10.15</a>).</li>
</ul>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1015"></span>
<img src="Img/CamposImgCol.png" alt="Ejemplo de una consulta de información de la colección de imágenes en la consola." width="80%" />
<p class="caption">
Figure 10.15: Ejemplo de una consulta de información de la colección de imágenes en la consola.
</p>
</div>
<p>A continuación se ordena la colección de manera ascendente de acuerdo a la propiedad de ‘CLOUD_COVER_LAND’. Se selecciona la primera imagen, es decir, la de menor cobertura de nubes. Nótese que en este paso, al definir la variable <code>L8imgFirst</code>, ya únicamente seleccionamos una sola imagen, por lo tanto, este va a ser un objeto <code>ee.Image</code>.
</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb108-1"><a href="ee.imagecollection-1.html#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Ordenar imágenes y obtener la primera</span></span>
<span id="cb108-2"><a href="ee.imagecollection-1.html#cb108-2" aria-hidden="true" tabindex="-1"></a>L8imgCol <span class="op">=</span> L8imgCol<span class="op">.</span><span class="fu">sort</span>(<span class="st">&#39;CLOUD_COVER_LAND&#39;</span>)<span class="op">;</span></span>
<span id="cb108-3"><a href="ee.imagecollection-1.html#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> L8imgFirst <span class="op">=</span> L8imgCol<span class="op">.</span><span class="fu">first</span>()<span class="op">;</span> </span>
<span id="cb108-4"><a href="ee.imagecollection-1.html#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(L8imgFirst)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Ordenar imágenes y obtener la primera
L8imgCol = L8imgCol.sort('CLOUD_COVER_LAND');
var L8imgFirst = L8imgCol.first(); 
print(L8imgFirst);
</script>
<p>Además, se puede agregar esta imagen a la ventana de mapas para visualizar su información (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1016">10.16</a>). Esto se puede realizar de dos maneras: 1) agregando la información sin pasar más argumentos, o 2) indicando las bandas y el orden que se desea cargar, así como los valores mínimos y máximos del histograma y un nombre para la capa.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb109-1"><a href="ee.imagecollection-1.html#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Agregar a la pantalla de mapa</span></span>
<span id="cb109-2"><a href="ee.imagecollection-1.html#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(L8imgFirst)<span class="op">;</span></span>
<span id="cb109-3"><a href="ee.imagecollection-1.html#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(L8imgFirst<span class="op">,</span>{<span class="dt">bands</span><span class="op">:</span> [<span class="st">&#39;B4&#39;</span><span class="op">,</span><span class="st">&#39;B3&#39;</span><span class="op">,</span><span class="st">&#39;B2&#39;</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">95</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1288</span>}<span class="op">,</span> </span>
<span id="cb109-4"><a href="ee.imagecollection-1.html#cb109-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;RGB menos nubes L8&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Agregar a la pantalla de mapa
Map.addLayer(L8imgFirst);
Map.addLayer(L8imgFirst,{bands: ['B4','B3','B2'], min: 95, max: 1288}, 
  'RGB menos nubes L8');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1016"></span>
<img src="Img/RGBIm.png" alt="Visualización de la primera imagen de la colección de imágenes." width="80%" />
<p class="caption">
Figure 10.16: Visualización de la primera imagen de la colección de imágenes.
</p>
</div>
</div>
<div id="ejercicio-c-enmascaramiento-de-nubes-cálculo-de-índices-y-reducción" class="section level4 unnumbered hasAnchor">
<h4>Ejercicio C: Enmascaramiento de nubes, cálculo de índices y reducción<a href="ee.imagecollection-1.html#ejercicio-c-enmascaramiento-de-nubes-cálculo-de-índices-y-reducción" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Este ejercicio integra elementos de los ejercicios 28.8 y 28.9, de modo que puede remitirse a estos ejercicios si necesita de una mayor aclaración.</p>
<p>Utilizando la colección que ya se filtró en el ejercicio anterior se hará un mapeo y una reducción. En este ejercicio se obtendrá el NDVI promedio entre 2015 y 2016. Para ello, lo primero que hay que hacer es aplicar la máscara de nubes que viene en la misma colección de imágenes de Landsat 8. Al aplicar esta máscara se eliminarán los píxeles cuya información provenga de nubes o sombras. Después, se definirá una función para calcular el NDVI de cada imagen contenida en la colección de imágenes, utilizando el método <code>.normalizedDifference</code> e indicando las bandas del infrarrojo cercano (NIR) y rojo (R). También, se utilizará el método <code>.rename</code> para cambiar el nombre dado por defecto a la nueva banda calculada. Posteriormente, se agrega esta banda a la imagen con el método <code>.addBands</code> y se utiliza el método <code>.map</code> para aplicarla a cada una de las imágenes.</p>
<p>En este procedimiento, primero se tiene que definir la función para enmascarar las nubes. Para ello, se indican los bits que corresponden a nubes y a sombras, es decir, los bits 5 y 3, respectivamente. Después se selecciona la banda que contiene la información de la máscara de nubes, la cual en Landsat 8 se llama ‘pixel_qa’. Se selecciona esta banda y se confirma que en los dos bits antes mencionados el valor sea igual a cero, es decir, que sea un píxel clasificado como despejado. En este procedimiento se indica que la consulta de los valores se debe hacer por bits (<code>.bitwiseAnd</code>) y que las dos evaluaciones deben de ser cero (<code>.and</code>). Posteriormente, se define una máscara en función de esos valores y se actualiza la máscara (<code>.updateMask</code>).
</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb110-1"><a href="ee.imagecollection-1.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Crear función para enmascarar nubes</span></span>
<span id="cb110-2"><a href="ee.imagecollection-1.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">maskL8sr</span>(image) {</span>
<span id="cb110-3"><a href="ee.imagecollection-1.html#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudShadowBitMask <span class="op">=</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb110-4"><a href="ee.imagecollection-1.html#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cloudsBitMask <span class="op">=</span> (<span class="dv">1</span> <span class="op">&lt;&lt;</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb110-5"><a href="ee.imagecollection-1.html#cb110-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> qa <span class="op">=</span> image<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;pixel_qa&#39;</span>)<span class="op">;</span></span>
<span id="cb110-6"><a href="ee.imagecollection-1.html#cb110-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> mask <span class="op">=</span> qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudShadowBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>)</span>
<span id="cb110-7"><a href="ee.imagecollection-1.html#cb110-7" aria-hidden="true" tabindex="-1"></a>                 <span class="op">.</span><span class="fu">and</span>(qa<span class="op">.</span><span class="fu">bitwiseAnd</span>(cloudsBitMask)<span class="op">.</span><span class="fu">eq</span>(<span class="dv">0</span>))<span class="op">;</span></span>
<span id="cb110-8"><a href="ee.imagecollection-1.html#cb110-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> image<span class="op">.</span><span class="fu">updateMask</span>(mask)<span class="op">;</span></span>
<span id="cb110-9"><a href="ee.imagecollection-1.html#cb110-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<script type="text/javascript">
// Crear función para enmascarar nubes
function maskL8sr(image) {
  var cloudShadowBitMask = (1 << 3);
  var cloudsBitMask = (1 << 5);
  var qa = image.select('pixel_qa');
  var mask = qa.bitwiseAnd(cloudShadowBitMask).eq(0)
                 .and(qa.bitwiseAnd(cloudsBitMask).eq(0));
  return image.updateMask(mask);
}
</script>
<p>Se define la función para calcular el NDVI de todas las imágenes.
</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb111-1"><a href="ee.imagecollection-1.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Crear función para calcular NDVI</span></span>
<span id="cb111-2"><a href="ee.imagecollection-1.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> ndviCalc <span class="op">=</span> <span class="kw">function</span>(image){</span>
<span id="cb111-3"><a href="ee.imagecollection-1.html#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> ndvi <span class="op">=</span> image<span class="op">.</span><span class="fu">normalizedDifference</span>([<span class="st">&#39;B5&#39;</span><span class="op">,</span><span class="st">&#39;B4&#39;</span>])<span class="op">;</span></span>
<span id="cb111-4"><a href="ee.imagecollection-1.html#cb111-4" aria-hidden="true" tabindex="-1"></a>  ndvi <span class="op">=</span> ndvi<span class="op">.</span><span class="fu">rename</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span>
<span id="cb111-5"><a href="ee.imagecollection-1.html#cb111-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image<span class="op">.</span><span class="fu">addBands</span>(ndvi)<span class="op">;</span></span>
<span id="cb111-6"><a href="ee.imagecollection-1.html#cb111-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Crear función para calcular NDVI
var ndviCalc = function(image){
  var ndvi = image.normalizedDifference(['B5','B4']);
  ndvi = ndvi.rename('ndvi');
    return image.addBands(ndvi);
};
</script>
<p>Para obtener una muestra de cómo se ve la primera imagen con y sin la máscara de nubes, primero se agregará la imagen con nubes a la pantalla de mapa (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1017">10.17</a>).
</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb112-1"><a href="ee.imagecollection-1.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Agregar la primera imagen a la pantalla de mapa</span></span>
<span id="cb112-2"><a href="ee.imagecollection-1.html#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(L8imgCol<span class="op">.</span><span class="fu">first</span>()<span class="op">,</span> </span>
<span id="cb112-3"><a href="ee.imagecollection-1.html#cb112-3" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">bands</span><span class="op">:</span>[<span class="st">&#39;B4&#39;</span><span class="op">,</span><span class="st">&#39;B3&#39;</span><span class="op">,</span><span class="st">&#39;B2&#39;</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1300</span>}<span class="op">,</span></span>
<span id="cb112-4"><a href="ee.imagecollection-1.html#cb112-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;Imagen con nubes&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Agregar la primera imagen a la pantalla de mapa
Map.addLayer(L8imgCol.first(), 
  {bands:['B4','B3','B2'], min: 0, max: 1300},
  'Imagen con nubes');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1017"></span>
<img src="Img/imNubes.png" alt="Ejemplo de una imagen con nubes." width="80%" />
<p class="caption">
Figure 10.17: Ejemplo de una imagen con nubes.
</p>
</div>
<p>A continuación se aplican las dos funciones utilizando <code>.map</code> y se sobreescribe el objeto <code>L8imgCol</code>.
</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb113-1"><a href="ee.imagecollection-1.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Aplicar las dos funciones a la colección</span></span>
<span id="cb113-2"><a href="ee.imagecollection-1.html#cb113-2" aria-hidden="true" tabindex="-1"></a>L8imgCol <span class="op">=</span> L8imgCol</span>
<span id="cb113-3"><a href="ee.imagecollection-1.html#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskL8sr)</span>
<span id="cb113-4"><a href="ee.imagecollection-1.html#cb113-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(ndviCalc)<span class="op">;</span></span>
<span id="cb113-5"><a href="ee.imagecollection-1.html#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(L8imgCol)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Aplicar las dos funciones a la colección
L8imgCol = L8imgCol
  .map(maskL8sr)
  .map(ndviCalc);
print(L8imgCol);
</script>
<p>Se muestra la primera imagen sin nubes (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1018">10.18</a>).
</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb114-1"><a href="ee.imagecollection-1.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Visualizar la primera imagen</span></span>
<span id="cb114-2"><a href="ee.imagecollection-1.html#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(L8imgCol<span class="op">.</span><span class="fu">first</span>()<span class="op">,</span> </span>
<span id="cb114-3"><a href="ee.imagecollection-1.html#cb114-3" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">bands</span><span class="op">:</span>[<span class="st">&#39;B4&#39;</span><span class="op">,</span><span class="st">&#39;B3&#39;</span><span class="op">,</span><span class="st">&#39;B2&#39;</span>]<span class="op">,</span> <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">1300</span>}<span class="op">,</span></span>
<span id="cb114-4"><a href="ee.imagecollection-1.html#cb114-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;Imagen sin nubes&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Visualizar la primera imagen
Map.addLayer(L8imgCol.first(), 
  {bands:['B4','B3','B2'], min: 0, max: 1300},
  'Imagen sin nubes');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1018"></span>
<img src="Img/imSinNubes.png" alt="Ejemplo de una imagen donde se enmascararon las nubes." width="80%" />
<p class="caption">
Figure 10.18: Ejemplo de una imagen donde se enmascararon las nubes.
</p>
</div>
<p>En la consola se puede observar que todas las imágenes ahora contienen una nueva banda llamada ‘ndvi’ (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1019">10.19</a>).</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1019"></span>
<img src="Img/imConNDVI.png" alt="Consulta de información en la consola para verificar que la colección de imágenes contiene la banda NDVI." width="80%" />
<p class="caption">
Figure 10.19: Consulta de información en la consola para verificar que la colección de imágenes contiene la banda NDVI.
</p>
</div>
<p>Posteriormente, se reduce la colección de imágenes para formar una sola imagen que represente el valor promedio de NDVI en el periodo de la colección (2015-2016), usando el método <code>.reduce</code>. También se calculará la desviación estándar de los valores de NDVI. Estas dos imágenes se guardarán en dos nuevos objetos.
</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb115-1"><a href="ee.imagecollection-1.html#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Seleccionar la banda ndvi y hacer dos reducciones</span></span>
<span id="cb115-2"><a href="ee.imagecollection-1.html#cb115-2" aria-hidden="true" tabindex="-1"></a>L8imgCol <span class="op">=</span> L8imgCol<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span>
<span id="cb115-3"><a href="ee.imagecollection-1.html#cb115-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> L8imgMean <span class="op">=</span> L8imgCol<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>())<span class="op">;</span></span>
<span id="cb115-4"><a href="ee.imagecollection-1.html#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> L8imgSD <span class="op">=</span> L8imgCol<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">stdDev</span>())<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Seleccionar la banda ndvi y hacer dos reducciones
L8imgCol = L8imgCol.select('ndvi');
var L8imgMean = L8imgCol.reduce(ee.Reducer.mean());
var L8imgSD = L8imgCol.reduce(ee.Reducer.stdDev());
</script>
<p>A continuación, agregamos los dos resultados a la pantalla de mapa y visualizamos el compuesto de media (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1020">10.20</a>).
</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb116-1"><a href="ee.imagecollection-1.html#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Visualizar las imágenes</span></span>
<span id="cb116-2"><a href="ee.imagecollection-1.html#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(L8imgMean<span class="op">,</span> {<span class="dt">min</span><span class="op">:-</span><span class="fl">0.14</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="fl">0.15</span>}<span class="op">,</span> <span class="st">&#39;NDVI mean 2015 - 2016&#39;</span>)<span class="op">;</span></span>
<span id="cb116-3"><a href="ee.imagecollection-1.html#cb116-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(L8imgSD<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="fl">0.13</span>}<span class="op">,</span> <span class="st">&#39;NDVI SD 2015 - 2016&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Visualizar las imágenes
Map.addLayer(L8imgMean, {min:-0.14, max:0.15}, 'NDVI mean 2015 - 2016');
Map.addLayer(L8imgSD, {min:0, max:0.13}, 'NDVI SD 2015 - 2016');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1020"></span>
<img src="Img/imNDVI.png" alt="Visualización de la imagen de NDVI promedio." width="80%" />
<p class="caption">
Figure 10.20: Visualización de la imagen de NDVI promedio.
</p>
</div>
<p>Se puede conocer el número de observaciones sin enmascarar por píxel utilizando el método <code>count</code>. Debido a que ya se enmascararon las nubes en todas las imágenes de la colección, esta imagen contendrá el número de observaciones sin nube por píxel. Esta información nos permite conocer a partir de cuántas observaciones por píxel se calcularon las imágenes anteriores, es decir, las imágenes con el promedio y desviación estándar de NDVI.
</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb117-1"><a href="ee.imagecollection-1.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Obtener la imagen del número de observaciones por píxel sin enmascarar </span></span>
<span id="cb117-2"><a href="ee.imagecollection-1.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> numObsPixel <span class="op">=</span> L8imgCol<span class="op">.</span><span class="fu">count</span>()<span class="op">;</span></span>
<span id="cb117-3"><a href="ee.imagecollection-1.html#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="ee.imagecollection-1.html#cb117-4" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(numObsPixel<span class="op">,</span></span>
<span id="cb117-5"><a href="ee.imagecollection-1.html#cb117-5" aria-hidden="true" tabindex="-1"></a>  {<span class="dt">min</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="dv">17</span>}<span class="op">,</span></span>
<span id="cb117-6"><a href="ee.imagecollection-1.html#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;Número de observaciones sin enmascarar por píxel&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Obtener la imagen del número de observaciones por píxel sin enmascarar 
var numObsPixel = L8imgCol.count();

Map.addLayer(numObsPixel,
  {min: 1, max: 17},
  'Número de observaciones sin enmascarar por píxel');
</script>
<p>La imagen con el número de observaciones por píxel sin enmascarar se ve así (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1021">10.21</a>):</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1021"></span>
<img src="Img/ImCount.png" alt="Visualización de la imagen con el número de observaciones sin enmascarar por píxel." width="80%" />
<p class="caption">
Figure 10.21: Visualización de la imagen con el número de observaciones sin enmascarar por píxel.
</p>
</div>
<div class="bluebox2">
<div class="awesomeblock">
<p>Se pueden prender y apagar las capas de la pantalla de mapa utilizando el menú que se despliega al posicionar el puntero sobre el letrero de layers y prendiendo y apagando las capas con las palomitas a la izquierda de cada capa.</p>
</div>
</div>
<p>El último paso será cortar la imagen a una extensión de interés. En este caso primero se define un área de interés mediante coordenadas:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb118-1"><a href="ee.imagecollection-1.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cargar el polígono del área de interés</span></span>
<span id="cb118-2"><a href="ee.imagecollection-1.html#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> geometry <span class="op">=</span> ee<span class="op">.</span><span class="at">Geometry</span><span class="op">.</span><span class="fu">Polygon</span>(</span>
<span id="cb118-3"><a href="ee.imagecollection-1.html#cb118-3" aria-hidden="true" tabindex="-1"></a>        [[[<span class="op">-</span><span class="fl">101.82737418916153</span><span class="op">,</span> <span class="fl">19.836437094032178</span>]<span class="op">,</span></span>
<span id="cb118-4"><a href="ee.imagecollection-1.html#cb118-4" aria-hidden="true" tabindex="-1"></a>          [<span class="op">-</span><span class="fl">101.82737418916153</span><span class="op">,</span> <span class="fl">19.368119068204525</span>]<span class="op">,</span></span>
<span id="cb118-5"><a href="ee.imagecollection-1.html#cb118-5" aria-hidden="true" tabindex="-1"></a>          [<span class="op">-</span><span class="fl">101.15171500947403</span><span class="op">,</span> <span class="fl">19.368119068204525</span>]<span class="op">,</span></span>
<span id="cb118-6"><a href="ee.imagecollection-1.html#cb118-6" aria-hidden="true" tabindex="-1"></a>          [<span class="op">-</span><span class="fl">101.15171500947403</span><span class="op">,</span> <span class="fl">19.836437094032178</span>]]]<span class="op">,</span> <span class="kw">null</span><span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cargar el polígono del área de interés
var geometry = ee.Geometry.Polygon(
        [[[-101.82737418916153, 19.836437094032178],
          [-101.82737418916153, 19.368119068204525],
          [-101.15171500947403, 19.368119068204525],
          [-101.15171500947403, 19.836437094032178]]], null, false);
</script>
<p>para después cortar las dos imágenes y mostrarlas en la pantalla de mapa (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1022">10.22</a>).
</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb119-1"><a href="ee.imagecollection-1.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Cortar la imágenes</span></span>
<span id="cb119-2"><a href="ee.imagecollection-1.html#cb119-2" aria-hidden="true" tabindex="-1"></a>L8imgMean <span class="op">=</span> L8imgMean<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb119-3"><a href="ee.imagecollection-1.html#cb119-3" aria-hidden="true" tabindex="-1"></a>L8imgSD <span class="op">=</span> L8imgSD<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb119-4"><a href="ee.imagecollection-1.html#cb119-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-5"><a href="ee.imagecollection-1.html#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Visualizarlas</span></span>
<span id="cb119-6"><a href="ee.imagecollection-1.html#cb119-6" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(L8imgMean<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span><span class="fl">0.2</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="fl">0.8</span>}<span class="op">,</span> <span class="st">&#39;NDVI mean 2015 - 2016 clip&#39;</span>)<span class="op">;</span></span>
<span id="cb119-7"><a href="ee.imagecollection-1.html#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(L8imgSD<span class="op">,</span> {<span class="dt">min</span><span class="op">:</span><span class="dv">0</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span><span class="fl">0.3</span>}<span class="op">,</span> <span class="st">&#39;NDVI SD 2015 - 2016 clip&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Cortar la imágenes
L8imgMean = L8imgMean.clip(geometry);
L8imgSD = L8imgSD.clip(geometry);

// Visualizarlas
Map.addLayer(L8imgMean, {min:0.2, max:0.8}, 'NDVI mean 2015 - 2016 clip');
Map.addLayer(L8imgSD, {min:0, max:0.3}, 'NDVI SD 2015 - 2016 clip');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1022"></span>
<img src="Img/meansdclip.png" alt="Visualización de los compuestos de media y desviación estándar cortados." width="80%" />
<p class="caption">
Figure 10.22: Visualización de los compuestos de media y desviación estándar cortados.
</p>
</div>
</div>
<div id="ejercicio-d-cálculo-de-diferencia-de-dos-imágenes-y-exportación-de-resultado" class="section level4 unnumbered hasAnchor">
<h4>Ejercicio D: Cálculo de diferencia de dos imágenes y exportación de resultado<a href="ee.imagecollection-1.html#ejercicio-d-cálculo-de-diferencia-de-dos-imágenes-y-exportación-de-resultado" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Se utilizarán las funciones previamente definidas para generar un mosaico igual al ya generado, pero ahora con fechas de 2016-01-01 al 2017-01-01. Primero se filtra la colección de imágenes y se mapean las funciones para enmascarar las nubes y agregar el NDVI a las imágenes.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb120-1"><a href="ee.imagecollection-1.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Filtrado en tiempo 2</span></span>
<span id="cb120-2"><a href="ee.imagecollection-1.html#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> L8imgColT2 <span class="op">=</span> ee<span class="op">.</span><span class="fu">ImageCollection</span>(<span class="st">&#39;LANDSAT/LC08/C01/T1_SR&#39;</span>)</span>
<span id="cb120-3"><a href="ee.imagecollection-1.html#cb120-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filterDate</span>(<span class="st">&#39;2016-01-01&#39;</span><span class="op">,</span><span class="st">&#39;2017-01-01&#39;</span>)</span>
<span id="cb120-4"><a href="ee.imagecollection-1.html#cb120-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">lte</span>(<span class="st">&#39;CLOUD_COVER_LAND&#39;</span><span class="op">,</span><span class="dv">50</span>))</span>
<span id="cb120-5"><a href="ee.imagecollection-1.html#cb120-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;WRS_PATH&#39;</span><span class="op">,</span><span class="dv">28</span>))</span>
<span id="cb120-6"><a href="ee.imagecollection-1.html#cb120-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(ee<span class="op">.</span><span class="at">Filter</span><span class="op">.</span><span class="fu">eq</span>(<span class="st">&#39;WRS_ROW&#39;</span><span class="op">,</span><span class="dv">46</span>))<span class="op">;</span></span>
<span id="cb120-7"><a href="ee.imagecollection-1.html#cb120-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-8"><a href="ee.imagecollection-1.html#cb120-8" aria-hidden="true" tabindex="-1"></a>L8imgColT2 <span class="op">=</span> L8imgColT2</span>
<span id="cb120-9"><a href="ee.imagecollection-1.html#cb120-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(maskL8sr)</span>
<span id="cb120-10"><a href="ee.imagecollection-1.html#cb120-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(ndviCalc)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Filtrado en tiempo 2
var L8imgColT2 = ee.ImageCollection('LANDSAT/LC08/C01/T1_SR')
  .filterDate('2016-01-01','2017-01-01')
  .filter(ee.Filter.lte('CLOUD_COVER_LAND',50))
  .filter(ee.Filter.eq('WRS_PATH',28))
  .filter(ee.Filter.eq('WRS_ROW',46));

L8imgColT2 = L8imgColT2
  .map(maskL8sr)
  .map(ndviCalc);
</script>
<p>Después, se seleccionan únicamente las bandas de NDVI y se reduce la colección de imágenes para generar una imagen del valor promedio de NDVI. Posteriormente, se recorta la imagen a la extensión del polígono del área de interés. A esta imagen se le restarán los valores de la imagen del 2015-01-01 al 2016-01-01. De esta manera, los valores más negativos representarán valores más bajos de NDVI en el año 2 respecto al año 1.
</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb121-1"><a href="ee.imagecollection-1.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Seleccionar NDVI y reducción</span></span>
<span id="cb121-2"><a href="ee.imagecollection-1.html#cb121-2" aria-hidden="true" tabindex="-1"></a>L8imgColT2 <span class="op">=</span> L8imgColT2<span class="op">.</span><span class="fu">select</span>(<span class="st">&#39;ndvi&#39;</span>)<span class="op">;</span></span>
<span id="cb121-3"><a href="ee.imagecollection-1.html#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> L8imgMeanT2 <span class="op">=</span> L8imgColT2<span class="op">.</span><span class="fu">reduce</span>(ee<span class="op">.</span><span class="at">Reducer</span><span class="op">.</span><span class="fu">mean</span>())<span class="op">;</span></span>
<span id="cb121-4"><a href="ee.imagecollection-1.html#cb121-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-5"><a href="ee.imagecollection-1.html#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="co">// Cortar imagen a área de interés</span></span>
<span id="cb121-6"><a href="ee.imagecollection-1.html#cb121-6" aria-hidden="true" tabindex="-1"></a>L8imgMeanT2 <span class="op">=</span> L8imgMeanT2<span class="op">.</span><span class="fu">clip</span>(geometry)<span class="op">;</span></span>
<span id="cb121-7"><a href="ee.imagecollection-1.html#cb121-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-8"><a href="ee.imagecollection-1.html#cb121-8" aria-hidden="true" tabindex="-1"></a><span class="co">// Restar media T1 a T2</span></span>
<span id="cb121-9"><a href="ee.imagecollection-1.html#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span> imgDiff <span class="op">=</span> L8imgMeanT2<span class="op">.</span><span class="fu">subtract</span>(L8imgMean)<span class="op">;</span>  </span></code></pre></div>
<script type="text/javascript">
// Seleccionar NDVI y reducción
L8imgColT2 = L8imgColT2.select('ndvi');
var L8imgMeanT2 = L8imgColT2.reduce(ee.Reducer.mean());

// Cortar imagen a área de interés
L8imgMeanT2 = L8imgMeanT2.clip(geometry);

// Restar media T1 a T2
var imgDiff = L8imgMeanT2.subtract(L8imgMean);  
</script>
<p>Posteriormente se agrega el resultado a la pantalla de mapa (<span style="color: darkblue;">Fig.</span> <a href="ee.imagecollection-1.html#fig:f1023">10.23</a>).</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb122-1"><a href="ee.imagecollection-1.html#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Visualizar imagen resultante</span></span>
<span id="cb122-2"><a href="ee.imagecollection-1.html#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Map</span><span class="op">.</span><span class="fu">addLayer</span>(imgDiff<span class="op">,</span>{<span class="dt">min</span><span class="op">:-</span><span class="fl">0.3</span><span class="op">,</span> <span class="dt">max</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span> </span>
<span id="cb122-3"><a href="ee.imagecollection-1.html#cb122-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">palette</span><span class="op">:</span>[<span class="st">&#39;FF0000&#39;</span><span class="op">,</span> <span class="st">&#39;FFFF00&#39;</span><span class="op">,</span> <span class="st">&#39;008000&#39;</span>] }<span class="op">,</span> </span>
<span id="cb122-4"><a href="ee.imagecollection-1.html#cb122-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&#39;Diferencia NDVI 2015 vs 2016&#39;</span>)<span class="op">;</span></span></code></pre></div>
<script type="text/javascript">
// Visualizar imagen resultante
Map.addLayer(imgDiff,{min:-0.3, max: 0.1, 
  palette:['FF0000', 'FFFF00', '008000'] }, 
  'Diferencia NDVI 2015 vs 2016');
</script>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:f1023"></span>
<img src="Img/imDifNDVI.png" alt="Imagen de la diferencia de NDVI entre dos años." width="80%" />
<p class="caption">
Figure 10.23: Imagen de la diferencia de NDVI entre dos años.
</p>
</div>
<p>Por último, para exportar el resultado se ingresan varios parámetros a la función, que incluyen: la imagen a exportar, el nombre para guardar el archivo, la escala de la imagen (tamaño de píxel en metros), formato a utilizar y si se desea guardar dentro de una carpeta del <strong>Google Drive</strong>. Estos argumentos, al igual que otras funciones en GEE, se pasan dentro de un diccionario.
</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode js"><code class="sourceCode javascript"><span id="cb123-1"><a href="ee.imagecollection-1.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Exportar imagen a Google Drive</span></span>
<span id="cb123-2"><a href="ee.imagecollection-1.html#cb123-2" aria-hidden="true" tabindex="-1"></a>Export<span class="op">.</span><span class="at">image</span><span class="op">.</span><span class="fu">toDrive</span>({</span>
<span id="cb123-3"><a href="ee.imagecollection-1.html#cb123-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">image</span><span class="op">:</span> imgDiff<span class="op">,</span></span>
<span id="cb123-4"><a href="ee.imagecollection-1.html#cb123-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">description</span><span class="op">:</span> <span class="st">&#39;DiferenciaNDVI_2016-2017&#39;</span><span class="op">,</span></span>
<span id="cb123-5"><a href="ee.imagecollection-1.html#cb123-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">scale</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span></span>
<span id="cb123-6"><a href="ee.imagecollection-1.html#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">maxPixels</span><span class="op">:</span> <span class="fl">1e12</span><span class="op">,</span></span>
<span id="cb123-7"><a href="ee.imagecollection-1.html#cb123-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fileFormat</span><span class="op">:</span> <span class="st">&#39;GeoTIFF&#39;</span><span class="op">,</span></span>
<span id="cb123-8"><a href="ee.imagecollection-1.html#cb123-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">folder</span><span class="op">:</span> <span class="st">&#39;DiferenciaNDVIL8&#39;</span><span class="op">,</span></span>
<span id="cb123-9"><a href="ee.imagecollection-1.html#cb123-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">region</span><span class="op">:</span> roi<span class="op">,</span></span>
<span id="cb123-10"><a href="ee.imagecollection-1.html#cb123-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">crs</span><span class="op">:</span> <span class="st">&#39;EPSG:4326</span></span>
<span id="cb123-11"><a href="ee.imagecollection-1.html#cb123-11" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span> </span></code></pre></div>
<script type="text/javascript">
// Exportar imagen a Google Drive
Export.image.toDrive({
  image: imgDiff,
  description: 'DiferenciaNDVI_2016-2017',
  scale: 30,
  maxPixels: 1e12,
  fileFormat: 'GeoTIFF',
  folder: 'DiferenciaNDVIL8',
  region: roi,
  crs: 'EPSG:4326
}); 
</script>

<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ee.image-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="uso-conjunto-de-vectores-e-imágenes.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "chapter"
}
});
});
</script>

</body>

</html>
